<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ù…Ø³Ø¦ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ù†ÙˆÙŠ 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --admin-color: #2c3e50;
            --admin-secondary: #34495e;
            --admin-accent: #1abc9c;
            --admin-warning: #e74c3c;
            --admin-success: #27ae60;
            --admin-info: #3498db;
            --admin-light: #ecf0f1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: var(--admin-light);
            direction: rtl;
            min-height: 100vh;
        }

        .header {
            background: rgba(44, 62, 80, 0.95);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-bottom: 4px solid var(--admin-accent);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--admin-accent) 0%, var(--admin-info) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .logo-text h1 {
            font-size: 24px;
            color: white;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .logo-text p {
            color: #bdc3c7;
            font-size: 14px;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
        }

        .admin-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-logout {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-refresh {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-container {
            max-width: 1600px;
            margin: 20px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid var(--admin-accent);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-title {
            color: var(--admin-color);
            font-size: 16px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ */
        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: white;
            border: 1px solid #ecf0f1;
            border-radius: 8px;
            color: var(--admin-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: #f8f9fa;
            border-color: var(--admin-accent);
        }

        .nav-link.active {
            background: linear-gradient(135deg, var(--admin-accent) 0%, #16a085 100%);
            color: white;
            border-color: var(--admin-accent);
        }

        /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… */
        .system-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            text-align: center;
        }

        .stat-number {
            font-size: 20px;
            font-weight: 700;
            color: var(--admin-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 11px;
            color: #6c757d;
            font-weight: 500;
        }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .content-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid var(--admin-accent);
        }

        .content-header {
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-title {
            color: var(--admin-color);
            font-size: 24px;
            font-weight: 700;
        }

        .content-subtitle {
            color: #6c757d;
            font-size: 14px;
            line-height: 1.5;
            margin-top: 5px;
        }

        /* Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        /* Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª */
        .evaluation-manager {
            overflow-x: auto;
        }

        .filters-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 180px;
        }

        .filter-label {
            display: block;
            margin-bottom: 5px;
            color: var(--admin-color);
            font-weight: 500;
            font-size: 12px;
        }

        .filter-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            color: var(--admin-color);
        }

        .search-box {
            position: relative;
            flex: 2;
            min-width: 250px;
        }

        .search-input {
            width: 100%;
            padding: 10px 35px 10px 15px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            color: var(--admin-color);
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-size: 16px;
        }

        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª */
        .evaluations-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .evaluations-table th {
            background: linear-gradient(135deg, var(--admin-color) 0%, var(--admin-secondary) 100%);
            color: white;
            padding: 12px 15px;
            text-align: right;
            font-weight: 500;
            font-size: 12px;
        }

        .evaluations-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #f1f5f9;
            color: var(--admin-color);
            font-size: 13px;
        }

        .evaluations-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            display: inline-block;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-deleted {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn-view {
            background: #d1ecf1;
            color: #0c5460;
        }

        .btn-print {
            background: #cce5ff;
            color: #004085;
        }

        .btn-delete {
            background: #f8d7da;
            color: #721c24;
        }

        .btn-restore {
            background: #fff3cd;
            color: #856404;
        }

        .btn-permanent-delete {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-report {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-1px);
        }

        /* Ø²Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
        .report-btn {
            padding: 10px 15px;
            background: linear-gradient(135deg, var(--admin-accent) 0%, #16a085 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .report-btn:hover {
            transform: translateY(-2px);
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 800px;
            max-height: 85vh;
            border-radius: 15px;
            padding: 25px;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .modal-title {
            color: var(--admin-color);
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--admin-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                order: 2;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                padding: 15px;
            }
            
            .admin-controls {
                width: 100%;
                justify-content: center;
            }
            
            .main-container {
                padding: 15px;
                margin: 15px auto;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .filters-bar {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <header class="header">
        <div class="logo-section">
            <div class="logo">âš™ï¸</div>
            <div class="logo-text">
                <h1>Ù„ÙˆØ­Ø© Ù…Ø³Ø¦ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</h1>
                <p>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ù†ÙˆÙŠ 2025</p>
            </div>
        </div>
        <div class="admin-controls">
            <button class="admin-btn btn-refresh" onclick="refreshSystem()">
                ğŸ”„ ØªØ­Ø¯ÙŠØ«
            </button>
            <button class="admin-btn btn-logout" onclick="logout()">
                ğŸšª Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">ğŸ“‹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#manage" class="nav-link active" onclick="showSection('manage')">
                            ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#users" class="nav-link" onclick="showSection('users')">
                            ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
                <div class="system-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalEvaluations">0</div>
                        <div class="stat-label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalEmployees">0</div>
                        <div class="stat-label">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="pendingCount">0</div>
                        <div class="stat-label">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="deletedCount">0</div>
                        <div class="stat-label">Ù…Ø­Ø°ÙˆÙØ©</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">â„¹ï¸ Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                <div style="color: var(--admin-color); font-size: 12px; line-height: 1.5;">
                    <p><strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> 2.0.1</p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span style="color: var(--admin-success);">ğŸŸ¢ Ù†Ø´Ø·</span></p>
                    <p><strong>Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„:</strong> <span id="currentAdmin">-</span></p>
                </div>
            </div>
        </aside>

        <main class="content-area">
            <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
            <section id="manage" class="content-section active">
                <div class="content-header">
                    <div>
                        <h2 class="content-title">ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h2>
                        <p class="content-subtitle">Ø¹Ø±Ø¶ØŒ Ø­Ø°ÙØŒ Ø§Ø³ØªØ¹Ø§Ø¯Ø©ØŒ ÙˆØ·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„Ø©</p>
                    </div>
                    <button class="report-btn" onclick="showEmployeeEvaluations()">
                        ğŸ‘¤ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                    </button>
                </div>
                
                <div class="filters-bar">
                    <div class="filter-group">
                        <label class="filter-label">Ø§Ù„ÙØ±Ø¹:</label>
                        <select id="filterBranch" class="filter-select" onchange="filterEvaluations()">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹</option>
                            <option value="ÙØ±Ø¹ Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±">Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±</option>
                            <option value="ÙØ±Ø¹ Ø£Ø³ÙŠÙˆØ·">Ø£Ø³ÙŠÙˆØ·</option>
                            <option value="ÙØ±Ø¹ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                            <option value="ÙØ±Ø¹ Ø§Ù„Ø£Ù‚ØµØ±">Ø§Ù„Ø£Ù‚ØµØ±</option>
                            <option value="ÙØ±Ø¹ Ø§Ù„Ù…Ù†ÙŠØ§">Ø§Ù„Ù…Ù†ÙŠØ§</option>
                            <option value="ÙØ±Ø¹ Ø³ÙˆÙ‡Ø§Ø¬">Ø³ÙˆÙ‡Ø§Ø¬</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                        <select id="filterStatus" class="filter-select" onchange="filterEvaluations()">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                            <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</option>
                            <option value="deleted">Ù…Ø­Ø°ÙˆÙ</option>
                        </select>
                    </div>
                    <div class="search-box">
                        <label class="filter-label">Ø¨Ø­Ø«:</label>
                        <input type="text" id="searchEvaluations" class="search-input" 
                               placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…..." oninput="searchEvaluations()">
                        <span class="search-icon">ğŸ”</span>
                    </div>
                </div>

                <div class="evaluation-manager">
                    <table class="evaluations-table" id="evaluationsTable">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th>Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…</th>
                                <th>Ø§Ù„ÙØ±Ø¹</th>
                                <th>Ø§Ù„Ù…ØªÙˆØ³Ø·</th>
                                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="evaluationsBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 30px; color: #6c757d;">
                                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
            <section id="users" class="content-section">
                <div class="content-header">
                    <h2 class="content-title">ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
                    <p class="content-subtitle">Ø¹Ø±Ø¶ØŒ ØªØ¹Ø¯ÙŠÙ„ØŒ ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                </div>

                <div class="system-stats" style="margin-bottom: 20px;">
                    <div class="stat-item">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="activeUsersCount">0</div>
                        <div class="stat-label">Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="adminsCount">0</div>
                        <div class="stat-label">Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„ÙŠÙ†</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="managersCount">0</div>
                        <div class="stat-label">Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†</div>
                    </div>
                </div>

                <div class="filters-bar">
                    <button class="report-btn" onclick="showAddUserModal()" style="min-width: 150px;">
                        â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…
                    </button>
                    <div class="filter-group">
                        <label class="filter-label">Ø§Ù„ÙØ±Ø¹:</label>
                        <select id="filterUsersBranch" class="filter-select" onchange="filterUsers()">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹</option>
                            <option value="ÙØ±Ø¹ Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±">Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±</option>
                            <option value="ÙØ±Ø¹ Ø£Ø³ÙŠÙˆØ·">Ø£Ø³ÙŠÙˆØ·</option>
                            <option value="ÙØ±Ø¹ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                            <option value="ÙØ±Ø¹ Ø§Ù„Ø£Ù‚ØµØ±">Ø§Ù„Ø£Ù‚ØµØ±</option>
                            <option value="ÙØ±Ø¹ Ø§Ù„Ù…Ù†ÙŠØ§">Ø§Ù„Ù…Ù†ÙŠØ§</option>
                            <option value="ÙØ±Ø¹ Ø³ÙˆÙ‡Ø§Ø¬">Ø³ÙˆÙ‡Ø§Ø¬</option>
                        </select>
                    </div>
                    <div class="search-box">
                        <label class="filter-label">Ø¨Ø­Ø«:</label>
                        <input type="text" id="searchUsers" class="search-input" 
                               placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…..." oninput="searchUsers()">
                        <span class="search-icon">ğŸ”</span>
                    </div>
                </div>

                <div class="evaluation-manager">
                    <table class="evaluations-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                <th>Ø§Ù„Ø¯ÙˆØ±</th>
                                <th>Ø§Ù„ÙØ±Ø¹</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="usersBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 30px; color: #6c757d;">
                                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ -->
    <div id="actionModal" class="modal" onclick="if(event.target.id === 'actionModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø§ÙØ°Ø©</h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div id="modalContent">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø§ÙØ°Ø© -->
            </div>
        </div>
    </div>

    <script>
        // ==================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase ====================
        const SUPABASE_URL = 'https://pzsxhypigslcvduegvpa.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6c3hoeXBpZ3NsY3ZkdWVndnBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0OTMxOTQsImV4cCI6MjA4MTA2OTE5NH0.0LC452nPLSywGh1mKxNQedm3M_yWZ4srck-gK67iZag';
        
        let supabaseClient;
        let currentUser = null;
        let allEvaluations = [];
        let filteredEvaluations = [];
        let allEmployees = [];
        let allUsers = [];
        let filteredUsers = [];
        let employeeEvaluations = {};
        let allQuestions = [];

        // ==================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ====================
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„...');
            
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                currentUser = JSON.parse(localStorage.getItem('caritas_user'));
                if (!currentUser) {
                    window.location.href = 'index.html';
                    return;
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ù…Ø³Ø¦ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… (Ø¯ÙˆØ± 7)
                if (currentUser.role_id !== 7) {
                    alert('â›” Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                    return;
                }

                // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„
                document.getElementById('currentAdmin').textContent = currentUser.full_name;

                // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…ÙŠÙ„ Supabase
                supabaseClient = supabase.createClient(SUPABASE_URL.trim(), SUPABASE_KEY.trim());
                console.log('âœ… Supabase client initialized');

                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await loadAllData();
                
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        });

        // ==================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ====================
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showError(message) {
            alert('âŒ Ø®Ø·Ø£: ' + message);
        }

        function closeModal() {
            document.getElementById('actionModal').style.display = 'none';
        }

        function showSection(sectionId) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(sectionId).classList.add('active');

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø´Ø·Ø©
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.nav-link[href="#${sectionId}"]`).classList.add('active');
        }

        function getRoleName(roleId) {
            switch (parseInt(roleId)) {
                case 1: return 'Ø£Ø®ØµØ§Ø¦ÙŠ Ù…ÙŠØ¯Ø§Ù†ÙŠ';
                case 2: return 'Ù…Ø³Ø¤ÙˆÙ„ ÙØ±ÙŠÙ‚';
                case 3: return 'Ù…Ø¯ÙŠØ± ÙØ±Ø¹';
                case 4: return 'Ù…Ø¯ÙŠØ± Ù†Ø´Ø§Ø·';
                case 5: return 'Ø¥Ø¯Ø§Ø±ÙŠ';
                case 6: return 'Ù…Ø±ÙƒØ² Ø±Ø¦ÙŠØ³ÙŠ';
                case 7: return 'Ù…Ø³Ø¦ÙˆÙ„ Ù†Ø¸Ø§Ù…';
                default: return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            }
        }

        function getBranchName(branch) {
            if (!branch) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            return branch.replace('ÙØ±Ø¹ ', '');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function getAnswerText(score) {
            if (score >= 9) return 'Ù…Ù…ØªØ§Ø²';
            if (score >= 7) return 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹';
            if (score >= 5) return 'Ø¬ÙŠØ¯';
            if (score >= 3) return 'Ù…Ù‚Ø¨ÙˆÙ„';
            return 'Ø¶Ø¹ÙŠÙ';
        }

        function getAnswerColor(score) {
            if (score >= 9) return '#27ae60';
            if (score >= 7) return '#2ecc71';
            if (score >= 5) return '#f39c12';
            if (score >= 3) return '#e67e22';
            return '#e74c3c';
        }

        // ==================== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ====================
        async function loadAllData() {
            showLoading();
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹
                await loadQuestions();
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                await loadEvaluationsData();
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                await loadEmployeesData();
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                await loadUsersData();
                
                hideLoading();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        async function loadQuestions() {
            try {
                const { data: questions, error: qError } = await supabaseClient
                    .from('evaluation_questions')
                    .select('*')
                    .eq('is_active', true)
                    .order('order_number', { ascending: true });
                
                if (qError) throw qError;
                allQuestions = questions || [];
                console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allQuestions.length} Ø³Ø¤Ø§Ù„`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:', error);
                allQuestions = [];
            }
        }

        async function loadEvaluationsData() {
            try {
                const { data: evaluations, error: evalError } = await supabaseClient
                    .from('evaluation_results')
                    .select(`
                        *,
                        evaluated_employee:evaluated_employee_id(full_name, branch, role_id),
                        evaluator:evaluator_id(full_name)
                    `)
                    .order('created_at', { ascending: false });

                if (evalError) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:', evalError);
                    allEvaluations = [];
                } else {
                    allEvaluations = evaluations || [];
                    filteredEvaluations = [...allEvaluations];
                    
                    // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù
                    organizeEmployeeEvaluations();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    updateEvaluationStats();
                }
                
                renderEvaluationsTable();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª');
            }
        }

        function organizeEmployeeEvaluations() {
            employeeEvaluations = {};
            
            allEvaluations.forEach(evaluation => {
                const employeeId = evaluation.evaluated_employee_id;
                if (!employeeEvaluations[employeeId]) {
                    employeeEvaluations[employeeId] = {
                        employee: evaluation.evaluated_employee,
                        evaluations: [],
                        totalScore: 0,
                        averageScore: 0,
                        evaluatorCount: 0
                    };
                }
                
                employeeEvaluations[employeeId].evaluations.push(evaluation);
                employeeEvaluations[employeeId].totalScore += (evaluation.score || 0);
                employeeEvaluations[employeeId].evaluatorCount++;
            });
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªÙˆØ³Ø· Ù„ÙƒÙ„ Ù…ÙˆØ¸Ù
            Object.values(employeeEvaluations).forEach(employeeData => {
                if (employeeData.evaluations.length > 0) {
                    employeeData.averageScore = Math.round(
                        (employeeData.totalScore / (employeeData.evaluations.length * 10)) * 100
                    );
                }
            });
        }

        function updateEvaluationStats() {
            document.getElementById('totalEvaluations').textContent = allEvaluations.length;
            document.getElementById('pendingCount').textContent = allEvaluations.filter(e => 
                !e.is_deleted && e.status !== 'completed'
            ).length;
            document.getElementById('deletedCount').textContent = allEvaluations.filter(e => 
                e.is_deleted
            ).length;
        }

        async function loadEmployeesData() {
            try {
                const { data: employees, error: empError } = await supabaseClient
                    .from('employees')
                    .select('id, full_name, branch, role_id')
                    .eq('is_active', true);
                
                if (empError) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:', empError);
                    allEmployees = [];
                } else {
                    allEmployees = employees || [];
                    document.getElementById('totalEmployees').textContent = allEmployees.length;
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
            }
        }

        async function loadUsersData() {
            try {
                const { data: users, error: userError } = await supabaseClient
                    .from('employees')
                    .select(`
                        id,
                        full_name,
                        username,
                        role_id,
                        branch,
                        is_active
                    `)
                    .order('full_name');
                
                if (userError) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:', userError);
                    allUsers = [];
                } else {
                    allUsers = users || [];
                    filteredUsers = [...allUsers];
                    updateUsersStats();
                }
                
                renderUsersTable();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†');
            }
        }

        function updateUsersStats() {
            const totalUsers = allUsers.length;
            const activeUsers = allUsers.filter(u => u.is_active).length;
            const adminsCount = allUsers.filter(u => u.role_id === 7).length;
            const managersCount = allUsers.filter(u => u.role_id === 3 || u.role_id === 4).length;
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('activeUsersCount').textContent = activeUsers;
            document.getElementById('adminsCount').textContent = adminsCount;
            document.getElementById('managersCount').textContent = managersCount;
        }

        // ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ====================
        function renderEvaluationsTable() {
            const tbody = document.getElementById('evaluationsBody');
            
            if (filteredEvaluations.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 30px; color: #6c757d;">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = '';
            
            filteredEvaluations.forEach(evaluation => {
                const employee = evaluation.evaluated_employee;
                const evaluatorName = evaluation.evaluator?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const employeeName = employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const branch = getBranchName(employee?.branch);
                
                const averageScore = evaluation.score ? Math.round((evaluation.score / 10) * 100) : 0;
                
                // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                const questionCount = evaluation.answers ? Object.keys(evaluation.answers).length : 0;
                
                const statusText = evaluation.is_deleted ? 'Ù…Ø­Ø°ÙˆÙ' : 
                                 evaluation.status === 'completed' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…';
                const statusClass = evaluation.is_deleted ? 'status-deleted' : 
                                   evaluation.status === 'completed' ? 'status-completed' : 'status-pending';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(evaluation.created_at).toLocaleDateString('ar-SA')}</td>
                    <td><strong>${employeeName}</strong></td>
                    <td>${evaluatorName}</td>
                    <td>${branch}</td>
                    <td><strong style="color: #1abc9c">${averageScore}%</strong></td>
                    <td>${questionCount}</td>
                    <td>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-view" onclick="showDetailedReport('${evaluation.id}')">
                                ğŸ“‹ Ø¹Ø±Ø¶
                            </button>
                            <button class="action-btn btn-print" onclick="printDetailedReport('${evaluation.id}')">
                                ğŸ–¨ï¸
                            </button>
                            ${evaluation.is_deleted ? 
                                `<button class="action-btn btn-restore" onclick="restoreEvaluation('${evaluation.id}')">
                                    ğŸ”„
                                </button>
                                <button class="action-btn btn-permanent-delete" onclick="permanentDeleteEvaluation('${evaluation.id}')">
                                    âš ï¸
                                </button>` : 
                                `<button class="action-btn btn-delete" onclick="deleteEvaluation('${evaluation.id}')">
                                    ğŸ—‘ï¸
                                </button>`
                            }
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function filterEvaluations() {
            const branchFilter = document.getElementById('filterBranch').value;
            const statusFilter = document.getElementById('filterStatus').value;

            filteredEvaluations = allEvaluations.filter(evaluation => {
                const employee = evaluation.evaluated_employee;
                
                if (!employee) return false;

                // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ø¹
                if (branchFilter !== 'all' && employee.branch !== branchFilter) {
                    return false;
                }

                // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
                if (statusFilter === 'completed' && (evaluation.is_deleted || evaluation.status !== 'completed')) {
                    return false;
                }
                if (statusFilter === 'pending' && (evaluation.is_deleted || evaluation.status !== 'pending')) {
                    return false;
                }
                if (statusFilter === 'deleted' && !evaluation.is_deleted) {
                    return false;
                }
                if (statusFilter !== 'deleted' && evaluation.is_deleted) {
                    return false;
                }
                
                return true;
            });

            renderEvaluationsTable();
        }

        function searchEvaluations() {
            const searchTerm = document.getElementById('searchEvaluations').value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredEvaluations = [...allEvaluations];
                renderEvaluationsTable();
                return;
            }
            
            filteredEvaluations = allEvaluations.filter(evaluation => {
                const employee = evaluation.evaluated_employee;
                const evaluatorName = evaluation.evaluator?.full_name || '';
                const employeeName = employee?.full_name || '';
                
                return (
                    employeeName.toLowerCase().includes(searchTerm) ||
                    evaluatorName.toLowerCase().includes(searchTerm) ||
                    (employee?.branch?.toLowerCase() || '').includes(searchTerm)
                );
            });

            renderEvaluationsTable();
        }

        // ==================== ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ Ø¨Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ====================
        async function showDetailedReport(evaluationId) {
            showLoading();
            try {
                const evaluation = allEvaluations.find(e => e.id === evaluationId);
                if (!evaluation) {
                    showError('Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    return;
                }
                
                const employee = evaluation.evaluated_employee;
                const evaluatorName = evaluation.evaluator?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const averageScore = evaluation.score ? Math.round((evaluation.score / 10) * 100) : 0;
                
                // ØªØ­Ù„ÙŠÙ„ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                let questionsHTML = '';
                if (allQuestions.length > 0) {
                    questionsHTML = `
                        <div style="margin-top: 20px;">
                            <h4 style="color: var(--admin-color); margin-bottom: 15px; border-bottom: 2px solid #1abc9c; padding-bottom: 8px;">
                                ğŸ“‹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª (${allQuestions.length} Ø³Ø¤Ø§Ù„)
                            </h4>
                            <div style="max-height: 400px; overflow-y: auto; padding-right: 10px;">
                    `;
                    
                    allQuestions.forEach((question, index) => {
                        const answer = evaluation.answers ? evaluation.answers[question.id] || 0 : 0;
                        const answerText = getAnswerText(answer);
                        const answerColor = getAnswerColor(answer);
                        
                        questionsHTML += `
                            <div style="background: #f8f9fa; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-right: 4px solid ${answerColor};">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                    <strong style="color: var(--admin-color); font-size: 14px;">Ø³ ${index + 1}: ${question.question_text}</strong>
                                    <span style="background: ${answerColor}; color: white; padding: 3px 10px; border-radius: 15px; font-size: 13px; font-weight: bold;">
                                        ${answer}/10
                                    </span>
                                </div>
                                <div style="color: #666; font-size: 14px; margin-top: 8px;">
                                    <strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> 
                                    <span style="color: ${answerColor}; font-weight: bold;">${answerText}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    questionsHTML += `
                            </div>
                        </div>
                    `;
                }

                const modalContent = `
                    <div style="padding: 15px; color: var(--admin-color);">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: var(--admin-color); margin-bottom: 15px;">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div> <strong>Ø§Ù„Ù…ÙˆØ¸Ù:</strong> ${employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} </div>
                                <div> <strong>Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…:</strong> ${evaluatorName} </div>
                                <div> <strong>Ø§Ù„ÙØ±Ø¹:</strong> ${getBranchName(employee?.branch)} </div>
                                <div> <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${formatDate(evaluation.created_at)} </div>
                                <div> <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${evaluation.is_deleted ? '<span style="color: #c0392b;">Ù…Ø­Ø°ÙˆÙ</span>' : 
                                                                     evaluation.status === 'completed' ? '<span style="color: #27ae60;">Ù…ÙƒØªÙ…Ù„</span>' : 
                                                                     '<span style="color: #e67e22;">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>'} </div>
                                <div> <strong>Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</strong> <span style="color: #1abc9c; font-weight: bold;">${averageScore}%</span> </div>
                            </div>
                        </div>

                        ${questionsHTML}

                        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h4 style="color: var(--admin-color); margin-bottom: 15px;">ğŸ’¬ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…</h4>
                            <p style="margin-top: 10px; padding: 15px; background: white; border-radius: 8px; border-right: 3px solid #3498db; line-height: 1.6; font-size: 14px;">
                                ${evaluation.comment || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø±ÙÙ‚Ø©.'}
                            </p>
                        </div>

                        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; flex-wrap: wrap;">
                            <button onclick="printDetailedReport('${evaluationId}')" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                                ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                            </button>
                            ${evaluation.is_deleted ? 
                                `<button onclick="restoreEvaluation('${evaluationId}')" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                                    ğŸ”„ Ø§Ø³ØªØ¹Ø§Ø¯Ø©
                                </button>` : 
                                `<button onclick="deleteEvaluation('${evaluationId}')" style="padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                                    ğŸ—‘ï¸ Ø­Ø°Ù
                                </button>` 
                            }
                            <button onclick="permanentDeleteEvaluation('${evaluationId}')" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                                âš ï¸ Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
                            </button>
                            <button onclick="closeModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px;">
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                        </div>
                    </div>
                `;

                document.getElementById('modalTitle').textContent = 'ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ Ù„Ù„ØªÙ‚ÙŠÙŠÙ…';
                document.getElementById('modalContent').innerHTML = modalContent;
                document.getElementById('actionModal').style.display = 'flex';
                hideLoading();

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„');
            }
        }

        // ==================== Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ====================
        async function deleteEvaluation(evaluationId) {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŸ\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹.')) {
                return;
            }

            showLoading();
            
            try {
                const { error } = await supabaseClient
                    .from('evaluation_results')
                    .update({ is_deleted: true })
                    .eq('id', evaluationId);
                
                if (error) throw error;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                const evaluationIndex = allEvaluations.findIndex(e => e.id === evaluationId);
                if (evaluationIndex !== -1) {
                    allEvaluations[evaluationIndex].is_deleted = true;
                }

                filteredEvaluations = filteredEvaluations.map(e => 
                    e.id === evaluationId ? {...e, is_deleted: true} : e
                );

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                document.getElementById('deletedCount').textContent = 
                    allEvaluations.filter(e => e.is_deleted).length;
                
                renderEvaluationsTable();
                hideLoading();
                closeModal();
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­');

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…');
            }
        }

        // ==================== Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ====================
        async function permanentDeleteEvaluation(evaluationId) {
            if (!confirm('âš ï¸ âš ï¸ âš ï¸ ØªØ­Ø°ÙŠØ± Ù‡Ø§Ù…!\n\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
                return;
            }

            showLoading();
            
            try {
                const { error } = await supabaseClient
                    .from('evaluation_results')
                    .delete()
                    .eq('id', evaluationId);
                
                if (error) throw error;

                // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                allEvaluations = allEvaluations.filter(e => e.id !== evaluationId);
                filteredEvaluations = filteredEvaluations.filter(e => e.id !== evaluationId);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø©
                organizeEmployeeEvaluations();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                updateEvaluationStats();
                
                renderEvaluationsTable();
                hideLoading();
                closeModal();
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø¬Ø§Ø­');

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…');
            }
        }

        // ==================== Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ====================
        async function restoreEvaluation(evaluationId) {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŸ')) {
                return;
            }

            showLoading();

            try {
                const { error } = await supabaseClient
                    .from('evaluation_results')
                    .update({ is_deleted: false })
                    .eq('id', evaluationId);
                
                if (error) throw error;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                const evaluationIndex = allEvaluations.findIndex(e => e.id === evaluationId);
                if (evaluationIndex !== -1) {
                    allEvaluations[evaluationIndex].is_deleted = false;
                }

                filteredEvaluations = filteredEvaluations.map(e => 
                    e.id === evaluationId ? {...e, is_deleted: false} : e
                );

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                document.getElementById('deletedCount').textContent = 
                    allEvaluations.filter(e => e.is_deleted).length;
                
                renderEvaluationsTable();
                hideLoading();
                closeModal();
                alert('âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­');

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…');
            }
        }

        // ==================== Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„ ====================
        async function printDetailedReport(evaluationId) {
            showLoading();
            try {
                const evaluation = allEvaluations.find(e => e.id === evaluationId);
                if (!evaluation) {
                    showError('Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    return;
                }
                
                const employee = evaluation.evaluated_employee;
                const evaluatorName = evaluation.evaluator?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const averageScore = evaluation.score ? Math.round((evaluation.score / 10) * 100) : 0;
                
                // Ø¨Ù†Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                let questionsContent = '';
                if (allQuestions.length > 0) {
                    allQuestions.forEach((question, index) => {
                        const answer = evaluation.answers ? evaluation.answers[question.id] || 0 : 0;
                        const answerText = getAnswerText(answer);
                        const answerColor = getAnswerColor(answer);
                        
                        questionsContent += `
                            <div style="margin-bottom: 15px; padding: 12px; border-bottom: 1px dashed #ddd; page-break-inside: avoid;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                    <strong style="color: #2c3e50; font-size: 14px;">
                                        Ø³ ${index + 1}: ${question.question_text}
                                    </strong>
                                    <span style="background: ${answerColor}; color: white; padding: 3px 10px; border-radius: 15px; font-size: 13px; font-weight: bold;">
                                        ${answer}/10
                                    </span>
                                </div>
                                <div style="color: #666; font-size: 14px;">
                                    <strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> 
                                    <span style="color: ${answerColor}; font-weight: bold;">${answerText}</span>
                                </div>
                            </div>
                        `;
                    });
                }
                
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html dir="rtl" lang="ar">
                    <head>
                        <meta charset="UTF-8">
                        <title>ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ù…ÙØµÙ„</title>
                        <style>
                            @media print {
                                @page { 
                                    margin: 15mm;
                                    size: A4;
                                }
                                body { 
                                    font-size: 12pt; 
                                    line-height: 1.6;
                                }
                                .no-print { 
                                    display: none !important; 
                                }
                                .page-break {
                                    page-break-before: always;
                                }
                            }
                            
                            body { 
                                font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                                direction: rtl; 
                                padding: 20px; 
                                margin: 0; 
                                color: #333;
                                background: white;
                            }
                            
                            .header { 
                                text-align: center; 
                                margin-bottom: 30px; 
                                padding-bottom: 20px;
                                border-bottom: 3px solid #1abc9c;
                            }
                            
                            .header h1 { 
                                color: #2c3e50; 
                                margin: 0 0 10px 0;
                                font-size: 24px;
                            }
                            
                            .header h2 { 
                                color: #7f8c8d; 
                                margin: 0;
                                font-size: 18px;
                                font-weight: normal;
                            }
                            
                            .info-grid { 
                                display: grid; 
                                grid-template-columns: 1fr 1fr; 
                                gap: 15px; 
                                margin: 25px 0; 
                                padding: 20px; 
                                background: #f8f9fa; 
                                border-radius: 10px;
                                border: 1px solid #ddd;
                            }
                            
                            .info-grid div {
                                padding: 8px 0;
                                border-bottom: 1px solid #eee;
                            }
                            
                            .info-grid strong {
                                color: #2c3e50;
                                display: inline-block;
                                min-width: 120px;
                            }
                            
                            .section-title {
                                color: #2c3e50;
                                margin: 25px 0 15px 0;
                                padding-bottom: 10px;
                                border-bottom: 2px solid #3498db;
                                font-size: 18px;
                            }
                            
                            .questions-section {
                                margin: 20px 0;
                                padding: 20px;
                                background: #f0f8ff;
                                border-radius: 10px;
                                border: 1px solid #bce8f1;
                            }
                            
                            .comment-section {
                                margin: 25px 0;
                                padding: 20px;
                                background: #fef9e7;
                                border-radius: 10px;
                                border: 1px solid #f1c40f;
                            }
                            
                            .score-badge {
                                display: inline-block;
                                padding: 5px 15px;
                                background: linear-gradient(135deg, #1abc9c, #16a085);
                                color: white;
                                border-radius: 20px;
                                font-weight: bold;
                                margin-right: 10px;
                            }
                            
                            .final-score {
                                text-align: center;
                                margin: 30px 0;
                                padding: 20px;
                                background: linear-gradient(135deg, #2c3e50, #34495e);
                                color: white;
                                border-radius: 10px;
                                font-size: 18px;
                            }
                            
                            .footer { 
                                text-align: center; 
                                margin-top: 40px; 
                                padding-top: 20px; 
                                border-top: 1px solid #ddd; 
                                color: #666; 
                                font-size: 12px;
                            }
                            
                            .print-btn {
                                display: inline-block;
                                margin: 20px 10px;
                                padding: 10px 25px;
                                background: #3498db;
                                color: white;
                                border: none;
                                border-radius: 5px;
                                cursor: pointer;
                                font-size: 14px;
                                text-decoration: none;
                            }
                            
                            .print-btn:hover {
                                background: #2980b9;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>ğŸ“Š ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙØµÙ„</h1>
                            <h2>ÙƒØ§Ø±ÙŠØªØ§Ø³ Ù…ØµØ± - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø§Ù…Ù„ 2025</h2>
                        </div>

                        <div class="info-grid">
                            <div><strong>Ø§Ù„Ù…ÙˆØ¸Ù:</strong> ${employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                            <div><strong>Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…:</strong> ${evaluatorName}</div>
                            <div><strong>Ø§Ù„ÙØ±Ø¹:</strong> ${getBranchName(employee?.branch)}</div>
                            <div><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${formatDate(evaluation.created_at)}</div>
                            <div><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${evaluation.is_deleted ? 'Ù…Ø­Ø°ÙˆÙ' : 
                                                          evaluation.status === 'completed' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'}</div>
                        </div>

                        <div class="final-score">
                            <h3 style="margin: 0 0 10px 0; color: white;">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
                            <div style="font-size: 36px; font-weight: bold; color: #1abc9c;">
                                ${averageScore}%
                            </div>
                            <div style="margin-top: 10px; font-size: 16px;">
                                (${evaluation.score || 0} / 10)
                            </div>
                        </div>

                        <h3 class="section-title">ğŸ“‹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª (${allQuestions.length} Ø³Ø¤Ø§Ù„)</h3>
                        <div class="questions-section">
                            ${questionsContent || '<p style="text-align: center; color: #777;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…ØªØ§Ø­Ø©</p>'}
                        </div>

                        <h3 class="section-title">ğŸ’¬ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…</h3>
                        <div class="comment-section">
                            <p style="margin: 0; padding: 15px; background: white; border-radius: 8px; line-height: 1.8; font-size: 14px;">
                                ${evaluation.comment || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø±ÙÙ‚Ø©.'}
                            </p>
                        </div>

                        <div class="footer">
                            <p>Â© ${new Date().getFullYear()} ÙƒØ§Ø±ÙŠØªØ§Ø³ Ù…ØµØ± - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø§Ù…Ù„ 2025</p>
                            <p>ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙˆØ§Ø³Ø·Ø©: ${currentUser.full_name}</p>
                            <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleString('ar-SA')}</p>
                            <div class="no-print">
                                <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                                <button class="print-btn" onclick="window.close()" style="background: #6c757d;">Ø¥ØºÙ„Ø§Ù‚</button>
                            </div>
                        </div>
                        
                        <script>
                            // Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                            window.onload = function() {
                                setTimeout(() => {
                                    window.print();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                hideLoading();

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
            }
        }

        // ==================== ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ====================
        function showEmployeeEvaluations() {
            if (Object.keys(employeeEvaluations).length === 0) {
                alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
                return;
            }

            let modalContent = `
                <div style="padding: 15px; color: var(--admin-color);">
                    <h3 style="margin-bottom: 20px; color: var(--admin-color);">ğŸ‘¥ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
                    <p style="color: #666; margin-bottom: 20px;">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙƒÙ„ Ù…ÙˆØ¸Ù Ù…Ø¹ Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ù…</p>
                    
                    <div style="max-height: 500px; overflow-y: auto; padding-right: 10px;">
            `;

            Object.values(employeeEvaluations).forEach((employeeData, index) => {
                const employee = employeeData.employee;
                const avgScore = employeeData.averageScore;
                const evaluatorCount = employeeData.evaluatorCount;
                
                modalContent += `
                    <div style="background: #f8f9fa; padding: 15px; margin-bottom: 15px; border-radius: 10px; border-right: 4px solid ${avgScore >= 70 ? '#27ae60' : avgScore >= 50 ? '#f39c12' : '#e74c3c'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong style="color: var(--admin-color); font-size: 16px;">${employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</strong>
                            <span style="background: ${avgScore >= 70 ? '#27ae60' : avgScore >= 50 ? '#f39c12' : '#e74c3c'}; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold;">
                                ${avgScore}%
                            </span>
                        </div>
                        <div style="color: #666; font-size: 14px; margin-bottom: 10px;">
                            <div><strong>Ø§Ù„ÙØ±Ø¹:</strong> ${getBranchName(employee?.branch)}</div>
                            <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…ÙŠÙ†:</strong> ${evaluatorCount}</div>
                            <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:</strong> ${employeeData.evaluations.length}</div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="showEmployeeDetailedReport('${employee?.id}')" style="padding: 8px 15px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </button>
                            <button onclick="printEmployeeReport('${employee?.id}')" style="padding: 8px 15px; background: #9b59b6; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                            </button>
                        </div>
                    </div>
                `;
            });

            modalContent += `
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                        <button onclick="closeModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('modalTitle').textContent = 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†';
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('actionModal').style.display = 'flex';
        }

        async function showEmployeeDetailedReport(employeeId) {
            const employeeData = employeeEvaluations[employeeId];
            if (!employeeData) return;

            let modalContent = `
                <div style="padding: 15px; color: var(--admin-color);">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: var(--admin-color); margin-bottom: 15px;">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div> <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${employeeData.employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} </div>
                            <div> <strong>Ø§Ù„ÙØ±Ø¹:</strong> ${getBranchName(employeeData.employee?.branch)} </div>
                            <div> <strong>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:</strong> ${employeeData.evaluations.length} </div>
                            <div> <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…ÙŠÙ†:</strong> ${employeeData.evaluatorCount} </div>
                            <div> <strong>Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ù…:</strong> <span style="color: #1abc9c; font-weight: bold;">${employeeData.averageScore}%</span> </div>
                        </div>
                    </div>

                    <h4 style="color: var(--admin-color); margin-bottom: 15px; border-bottom: 2px solid #3498db; padding-bottom: 8px;">ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h4>
                    <div style="max-height: 400px; overflow-y: auto; padding-right: 10px;">
            `;

            employeeData.evaluations.forEach((evaluation, index) => {
                const evaluatorName = evaluation.evaluator?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const score = evaluation.score ? Math.round((evaluation.score / 10) * 100) : 0;
                
                modalContent += `
                    <div style="background: #e8f4f8; padding: 15px; margin-bottom: 10px; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <strong style="color: var(--admin-color);">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ${index + 1}</strong>
                            <span style="background: ${score >= 70 ? '#27ae60' : score >= 50 ? '#f39c12' : '#e74c3c'}; color: white; padding: 3px 10px; border-radius: 15px; font-weight: bold;">
                                ${score}%
                            </span>
                        </div>
                        <div style="color: #666; font-size: 14px;">
                            <div><strong>Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…:</strong> ${evaluatorName}</div>
                            <div><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${formatDate(evaluation.created_at)}</div>
                            <div><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${evaluation.is_deleted ? 'Ù…Ø­Ø°ÙˆÙ' : evaluation.status}</div>
                        </div>
                        <div style="margin-top: 10px;">
                            <button onclick="showDetailedReport('${evaluation.id}')" style="padding: 5px 10px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </button>
                        </div>
                    </div>
                `;
            });

            modalContent += `
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                        <button onclick="printEmployeeReport('${employeeId}')" style="padding: 10px 20px; background: #9b59b6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„
                        </button>
                        <button onclick="closeModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('modalTitle').textContent = `ØªÙØ§ØµÙŠÙ„ ØªÙ‚ÙŠÙŠÙ…Ø§Øª ${employeeData.employee?.full_name}`;
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('actionModal').style.display = 'flex';
        }

        // ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ====================
        function renderUsersTable() {
            const tbody = document.getElementById('usersBody');
            
            if (filteredUsers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 30px; color: #6c757d;">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ† Ù„Ù„Ø¨Ø­Ø«
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = '';
            
            filteredUsers.forEach(user => {
                const roleName = getRoleName(user.role_id);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${user.full_name}</strong></td>
                    <td>${user.username}</td>
                    <td>${roleName}</td>
                    <td>${getBranchName(user.branch)}</td>
                    <td>
                        ${user.is_active ? 
                            '<span class="status-badge status-completed">Ù†Ø´Ø·</span>' : 
                            '<span class="status-badge status-deleted">Ù…Ø¹Ø·Ù„</span>'
                        }
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-view" onclick="editUser('${user.id}')">
                                âœï¸
                            </button>
                            ${user.is_active ? 
                                `<button class="action-btn btn-delete" onclick="deactivateUser('${user.id}', '${user.full_name}')">
                                    â›”
                                </button>` :
                                `<button class="action-btn btn-restore" onclick="activateUser('${user.id}', '${user.full_name}')">
                                    âœ…
                                </button>`
                            }
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function filterUsers() {
            const branchFilter = document.getElementById('filterUsersBranch').value;
            
            filteredUsers = allUsers.filter(user => {
                if (branchFilter !== 'all' && user.branch !== branchFilter) {
                    return false;
                }
                return true;
            });
            
            renderUsersTable();
        }

        function searchUsers() {
            const searchTerm = document.getElementById('searchUsers').value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredUsers = [...allUsers];
                renderUsersTable();
                return;
            }
            
            filteredUsers = allUsers.filter(user => {
                return (
                    (user.full_name?.toLowerCase() || '').includes(searchTerm) ||
                    (user.username?.toLowerCase() || '').includes(searchTerm)
                );
            });
            
            renderUsersTable();
        }

        async function editUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;
            
            const modalContent = `
                <div style="padding: 15px; color: var(--admin-color);">
                    <h3 style="margin-bottom: 20px;">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
                                <input type="text" id="editFullName" class="filter-select" value="${user.full_name}" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                                <input type="text" id="editUsername" class="filter-select" value="${user.username}" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø¯ÙˆØ±:</label>
                                <select id="editRoleId" class="filter-select" style="width: 100%;">
                                    <option value="1" ${user.role_id == 1 ? 'selected' : ''}>Ø£Ø®ØµØ§Ø¦ÙŠ Ù…ÙŠØ¯Ø§Ù†ÙŠ</option>
                                    <option value="2" ${user.role_id == 2 ? 'selected' : ''}>Ù…Ø³Ø¤ÙˆÙ„ ÙØ±ÙŠÙ‚</option>
                                    <option value="3" ${user.role_id == 3 ? 'selected' : ''}>Ù…Ø¯ÙŠØ± ÙØ±Ø¹</option>
                                    <option value="4" ${user.role_id == 4 ? 'selected' : ''}>Ù…Ø¯ÙŠØ± Ù†Ø´Ø§Ø·</option>
                                    <option value="5" ${user.role_id == 5 ? 'selected' : ''}>Ø¥Ø¯Ø§Ø±ÙŠ</option>
                                    <option value="6" ${user.role_id == 6 ? 'selected' : ''}>Ù…Ø±ÙƒØ² Ø±Ø¦ÙŠØ³ÙŠ</option>
                                    <option value="7" ${user.role_id == 7 ? 'selected' : ''}>Ù…Ø³Ø¦ÙˆÙ„ Ù†Ø¸Ø§Ù…</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„ÙØ±Ø¹:</label>
                                <select id="editBranch" class="filter-select" style="width: 100%;">
                                    <option value="ÙØ±Ø¹ Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±" ${user.branch === 'ÙØ±Ø¹ Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±' ? 'selected' : ''}>Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±</option>
                                    <option value="ÙØ±Ø¹ Ø£Ø³ÙŠÙˆØ·" ${user.branch === 'ÙØ±Ø¹ Ø£Ø³ÙŠÙˆØ·' ? 'selected' : ''}>Ø£Ø³ÙŠÙˆØ·</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©" ${user.branch === 'ÙØ±Ø¹ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©' ? 'selected' : ''}>Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ø£Ù‚ØµØ±" ${user.branch === 'ÙØ±Ø¹ Ø§Ù„Ø£Ù‚ØµØ±' ? 'selected' : ''}>Ø§Ù„Ø£Ù‚ØµØ±</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ù…Ù†ÙŠØ§" ${user.branch === 'ÙØ±Ø¹ Ø§Ù„Ù…Ù†ÙŠØ§' ? 'selected' : ''}>Ø§Ù„Ù…Ù†ÙŠØ§</option>
                                    <option value="ÙØ±Ø¹ Ø³ÙˆÙ‡Ø§Ø¬" ${user.branch === 'ÙØ±Ø¹ Ø³ÙˆÙ‡Ø§Ø¬' ? 'selected' : ''}>Ø³ÙˆÙ‡Ø§Ø¬</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                        <button onclick="saveUserChanges('${user.id}')" style="padding: 10px 20px; background: var(--admin-accent); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            ğŸ’¾ Ø­ÙØ¸
                        </button>
                        <button onclick="closeModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('actionModal').style.display = 'flex';
        }

        async function saveUserChanges(userId) {
            const fullName = document.getElementById('editFullName').value.trim();
            const username = document.getElementById('editUsername').value.trim();
            const roleId = parseInt(document.getElementById('editRoleId').value);
            const branch = document.getElementById('editBranch').value;
            
            if (!fullName || !username) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                return;
            }
            
            showLoading();
            
            try {
                const { error } = await supabaseClient
                    .from('employees')
                    .update({
                        full_name: fullName,
                        username: username,
                        role_id: roleId,
                        branch: branch
                    })
                    .eq('id', userId);
                
                if (error) throw error;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                const userIndex = allUsers.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    allUsers[userIndex] = {
                        ...allUsers[userIndex],
                        full_name: fullName,
                        username: username,
                        role_id: roleId,
                        branch: branch
                    };
                }
                
                renderUsersTable();
                updateUsersStats();
                
                hideLoading();
                closeModal();
                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function deactivateUser(userId, userName) {
            if (!confirm(`âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:\n${userName}ØŸ`)) return;
            
            showLoading();
            
            try {
                const { error } = await supabaseClient
                    .from('employees')
                    .update({ is_active: false })
                    .eq('id', userId);
                
                if (error) throw error;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                const userIndex = allUsers.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    allUsers[userIndex].is_active = false;
                }
                
                renderUsersTable();
                updateUsersStats();
                
                hideLoading();
                alert('âœ… ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function activateUser(userId, userName) {
            if (!confirm(`âœ… Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:\n${userName}ØŸ`)) return;
            
            showLoading();
            
            try {
                const { error } = await supabaseClient
                    .from('employees')
                    .update({ is_active: true })
                    .eq('id', userId);
                
                if (error) throw error;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                const userIndex = allUsers.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    allUsers[userIndex].is_active = true;
                }
                
                renderUsersTable();
                updateUsersStats();
                
                hideLoading();
                alert('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function showAddUserModal() {
            const modalContent = `
                <div style="padding: 15px; color: var(--admin-color);">
                    <h3 style="margin-bottom: 20px;">ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *:</label>
                                <input type="text" id="newFullName" class="filter-select" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *:</label>
                                <input type="text" id="newUsername" class="filter-select" placeholder="username" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *:</label>
                                <input type="text" id="newPassword" class="filter-select" value="pass123" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø¯ÙˆØ± *:</label>
                                <select id="newRoleId" class="filter-select" style="width: 100%;">
                                    <option value="1">Ø£Ø®ØµØ§Ø¦ÙŠ Ù…ÙŠØ¯Ø§Ù†ÙŠ</option>
                                    <option value="2">Ù…Ø³Ø¤ÙˆÙ„ ÙØ±ÙŠÙ‚</option>
                                    <option value="3">Ù…Ø¯ÙŠØ± ÙØ±Ø¹</option>
                                    <option value="4">Ù…Ø¯ÙŠØ± Ù†Ø´Ø§Ø·</option>
                                    <option value="5">Ø¥Ø¯Ø§Ø±ÙŠ</option>
                                    <option value="6">Ù…Ø±ÙƒØ² Ø±Ø¦ÙŠØ³ÙŠ</option>
                                    <option value="7">Ù…Ø³Ø¦ÙˆÙ„ Ù†Ø¸Ø§Ù…</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„ÙØ±Ø¹ *:</label>
                                <select id="newBranch" class="filter-select" style="width: 100%;">
                                    <option value="ÙØ±Ø¹ Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±">Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±</option>
                                    <option value="ÙØ±Ø¹ Ø£Ø³ÙŠÙˆØ·">Ø£Ø³ÙŠÙˆØ·</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ø£Ù‚ØµØ±">Ø§Ù„Ø£Ù‚ØµØ±</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ù…Ù†ÙŠØ§">Ø§Ù„Ù…Ù†ÙŠØ§</option>
                                    <option value="ÙØ±Ø¹ Ø³ÙˆÙ‡Ø§Ø¬">Ø³ÙˆÙ‡Ø§Ø¬</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                        <button onclick="addNewUser()" style="padding: 10px 20px; background: var(--admin-accent); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            â• Ø¥Ø¶Ø§ÙØ©
                        </button>
                        <button onclick="closeModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('modalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯';
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('actionModal').style.display = 'flex';
        }

        async function addNewUser() {
            const fullName = document.getElementById('newFullName').value.trim();
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value;
            const roleId = parseInt(document.getElementById('newRoleId').value);
            const branch = document.getElementById('newBranch').value;
            
            if (!fullName || !username || !password) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            if (password.length < 4) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            showLoading();
            
            try {
                const { error } = await supabaseClient
                    .from('employees')
                    .insert({
                        full_name: fullName,
                        username: username,
                        password_hash: password,
                        role_id: roleId,
                        branch: branch,
                        is_active: true,
                        created_at: new Date().toISOString()
                    });
                
                if (error) throw error;
                
                await loadUsersData();
                
                hideLoading();
                closeModal();
                
                alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­\n\nØ§Ù„Ø§Ø³Ù…: ${fullName}\nØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${username}\nÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${password}`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                hideLoading();
                
                if (error.message.includes('Ù…ÙˆØ¬ÙˆØ¯')) {
                    showError('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø¢Ø®Ø±');
                } else {
                    showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                }
            }
        }

        // ==================== ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ© ====================
        function refreshSystem() {
            loadAllData();
            alert('ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…');
        }

        function logout() {
            localStorage.removeItem('caritas_user');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>