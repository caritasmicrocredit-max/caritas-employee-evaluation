<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- âœ… Ù…Ù†Ø¹ Ø§Ù„ÙƒØ§Ø´ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø³Ø¦ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ù†ÙˆÙŠ 2025</title>
    
    <!-- âœ… ØªØ­Ù…ÙŠÙ„ Supabase Ù…Ù† CDN (Ø«Ø§Ø¨Øª) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --admin-color: #2c3e50;
            --admin-secondary: #34495e;
            --admin-accent: #1abc9c;
            --admin-warning: #e74c3c;
            --admin-success: #27ae60;
            --admin-info: #3498db;
            --admin-light: #ecf0f1;
            --admin-dark: #2c3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: var(--admin-light);
            direction: rtl;
            min-height: 100vh;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header {
            background: rgba(44, 62, 80, 0.95);
            padding: 25px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            border-bottom: 4px solid var(--admin-accent);
            position: relative;
            z-index: 100;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -4px;
            right: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #1abc9c, #3498db, #9b59b6);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--admin-accent) 0%, var(--admin-info) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(26, 188, 156, 0.3);
        }

        .logo-text h1 {
            font-size: 32px;
            color: white;
            margin-bottom: 8px;
            font-weight: 800;
        }

        .logo-text p {
            color: #bdc3c7;
            font-size: 16px;
            font-weight: 500;
        }

        .admin-controls {
            display: flex;
            gap: 15px;
        }

        .admin-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-logout {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-refresh {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .admin-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-container {
            max-width: 1800px;
            margin: 40px auto;
            padding: 0 30px;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 40px;
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border: 3px solid var(--admin-accent);
            height: fit-content;
            position: sticky;
            top: 40px;
        }

        .sidebar-section {
            margin-bottom: 35px;
        }

        .sidebar-title {
            color: var(--admin-color);
            font-size: 20px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ecf0f1;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ */
        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 12px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 20px;
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            color: var(--admin-color);
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: #f8f9fa;
            border-color: var(--admin-accent);
            transform: translateX(-5px);
        }

        .nav-link.active {
            background: linear-gradient(135deg, var(--admin-accent) 0%, #16a085 100%);
            color: white;
            border-color: var(--admin-accent);
            box-shadow: 0 5px 15px rgba(26, 188, 156, 0.3);
        }

        .nav-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… */
        .system-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            text-align: center;
        }

        .stat-number {
            font-size: 28px;
            font-weight: 800;
            color: var(--admin-color);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 13px;
            color: #6c757d;
            font-weight: 600;
        }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .content-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border: 3px solid var(--admin-accent);
        }

        .content-header {
            margin-bottom: 40px;
        }

        .content-title {
            color: var(--admin-color);
            font-size: 32px;
            margin-bottom: 15px;
            font-weight: 800;
        }

        .content-subtitle {
            color: #6c757d;
            font-size: 18px;
            line-height: 1.6;
        }

        /* Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        /* Ù‚Ø³Ù… Ø´Ø±Ø­ Ø§Ù„Ù†Ø¸Ø§Ù… */
        .system-guide {
            line-height: 1.8;
            color: var(--admin-color);
        }

        .guide-section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 20px;
            border: 2px solid #e9ecef;
        }

        .guide-title {
            color: var(--admin-color);
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--admin-accent);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .guide-content {
            font-size: 16px;
            line-height: 1.8;
        }

        .guide-content p {
            margin-bottom: 15px;
        }

        .guide-content ul {
            margin-right: 25px;
            margin-bottom: 20px;
        }

        .guide-content li {
            margin-bottom: 12px;
            position: relative;
            padding-right: 25px;
        }

        .guide-content li::before {
            content: 'â€¢';
            color: var(--admin-accent);
            font-size: 24px;
            position: absolute;
            right: 0;
        }

        /* Ù…Ø®Ø·Ø· Ø§Ù„Ø£Ø¯ÙˆØ§Ø± */
        .roles-diagram {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .role-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            border: 3px solid;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .role-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .role-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--admin-accent), var(--admin-info));
        }

        .role-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .role-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            font-weight: bold;
        }

        .role-info h3 {
            color: var(--admin-color);
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .role-info p {
            color: #6c757d;
            font-size: 14px;
        }

        .role-permissions {
            margin-top: 25px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 14px;
        }

        .permission-check {
            color: var(--admin-success);
            font-size: 18px;
        }

        /* Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª */
        .evaluation-manager {
            overflow-x: auto;
        }

        .filters-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            display: block;
            margin-bottom: 10px;
            color: var(--admin-color);
            font-weight: 600;
            font-size: 14px;
        }

        .filter-select {
            width: 100%;
            padding: 14px;
            border: 2px solid #ced4da;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            color: var(--admin-color);
            transition: all 0.3s;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--admin-accent);
            box-shadow: 0 0 0 4px rgba(26, 188, 156, 0.1);
        }

        .search-box {
            position: relative;
            flex: 2;
            min-width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 14px 50px 14px 20px;
            border: 2px solid #ced4da;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            color: var(--admin-color);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-size: 20px;
        }

        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª */
        .evaluations-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .evaluations-table th {
            background: linear-gradient(135deg, var(--admin-color) 0%, var(--admin-secondary) 100%);
            color: white;
            padding: 20px;
            text-align: right;
            font-weight: 600;
            font-size: 16px;
        }

        .evaluations-table td {
            padding: 18px 20px;
            border-bottom: 2px solid #f1f5f9;
            color: var(--admin-color);
            font-size: 15px;
        }

        .evaluations-table tr:hover {
            background: #f8f9fa;
        }

        .evaluations-table tr:last-child td {
            border-bottom: none;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: inline-block;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-deleted {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .btn-view {
            background: #d1ecf1;
            color: #0c5460;
        }

        .btn-edit {
            background: #d4edda;
            color: #155724;
        }

        .btn-delete {
            background: #f8d7da;
            color: #721c24;
        }

        .btn-restore {
            background: #fff3cd;
            color: #856404;
        }

        .btn-print {
            background: #cce5ff;
            color: #004085;
        }

        .btn-reset {
            background: #f3e5f5;
            color: #4a148c;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
        .reports-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }

        .report-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            border: 3px solid #e9ecef;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .report-card:hover {
            border-color: var(--admin-accent);
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .report-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #f1f5f9;
        }

        .report-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .report-info h3 {
            color: var(--admin-color);
            font-size: 20px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .report-info p {
            color: #6c757d;
            font-size: 14px;
        }

        .report-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            color: var(--admin-color);
            font-weight: 600;
            font-size: 14px;
        }

        .report-btn {
            padding: 16px;
            background: linear-gradient(135deg, var(--admin-accent) 0%, #16a085 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .report-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 188, 156, 0.3);
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
        .alert-buttons {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 3px solid #f1f5f9;
        }

        .alert-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .btn-backup {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .btn-audit {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
        }

        .alert-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            border-radius: 25px;
            padding: 40px;
            overflow-y: auto;
            box-shadow: 0 30px 60px rgba(0,0,0,0.4);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #f1f5f9;
        }

        .modal-title {
            color: var(--admin-color);
            font-size: 28px;
            font-weight: 800;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 32px;
            cursor: pointer;
            color: #6c757d;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            width: 80px;
            height: 80px;
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--admin-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                order: 2;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
                padding: 20px;
            }
            
            .admin-controls {
                width: 100%;
                justify-content: center;
            }
            
            .admin-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .main-container {
                padding: 20px;
                margin: 20px auto;
            }
            
            .content-area {
                padding: 25px;
            }
            
            .roles-diagram {
                grid-template-columns: 1fr;
            }
            
            .filters-bar {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .reports-section {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 25px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <header class="header">
        <div class="logo-section">
            <div class="logo">âš™ï¸</div>
            <div class="logo-text">
                <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø³Ø¦ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</h1>
                <p>Ø¥Ø¯Ø§Ø±Ø© ÙˆØªÙ†Ø¸ÙŠÙ… Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø§Ù…Ù„ 2025</p>
            </div>
        </div>
        <div class="admin-controls">
            <button class="admin-btn btn-refresh" onclick="refreshSystem()">
                ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…
            </button>
            <button class="admin-btn btn-logout" onclick="logout()">
                ğŸšª Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†
            </button>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">ğŸ“‹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#guide" class="nav-link active" onclick="showSection('guide')">
                            <span class="nav-icon">ğŸ“š</span>
                            <span>Ø´Ø±Ø­ Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#roles" class="nav-link" onclick="showSection('roles')">
                            <span class="nav-icon">ğŸ‘¥</span>
                            <span>Ù…Ø®Ø·Ø· Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#manage" class="nav-link" onclick="showSection('manage')">
                            <span class="nav-icon">âš™ï¸</span>
                            <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#reports" class="nav-link" onclick="showSection('reports')">
                            <span class="nav-icon">ğŸ“Š</span>
                            <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#tools" class="nav-link" onclick="showSection('tools')">
                            <span class="nav-icon">ğŸ”§</span>
                            <span>Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#users" class="nav-link" onclick="showSection('users')">
                            <span class="nav-icon">ğŸ‘¤</span>
                            <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                <div class="system-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalEvaluations">0</div>
                        <div class="stat-label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalEmployees">0</div>
                        <div class="stat-label">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="pendingCount">0</div>
                        <div class="stat-label">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="deletedCount">0</div>
                        <div class="stat-label">Ù…Ø­Ø°ÙˆÙØ©</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                <div style="color: var(--admin-color); font-size: 14px; line-height: 1.6;">
                    <p><strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> <span id="systemVersion">2.5.0</span></p>
                    <p><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> <span id="lastUpdate">2025-01-20</span></p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span style="color: var(--admin-success);">ğŸŸ¢ Ù†Ø´Ø·</span></p>
                    <p><strong>Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„:</strong> <span id="currentAdmin">-</span></p>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="alert-buttons">
                    <button class="alert-btn btn-backup" onclick="backupSystem()">
                        ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                    </button>
                    <button class="alert-btn btn-audit" onclick="showAuditLog()">
                        ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚
                    </button>
                </div>
            </div>
        </aside>

        <main class="content-area">
            <!-- Ø¬Ù…ÙŠØ¹ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ -->
            <!-- ... Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ ... -->
        </main>
    </div>

    <div id="actionModal" class="modal" onclick="if(event.target.id === 'actionModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø§ÙØ°Ø©</h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div id="modalContent">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø§ÙØ°Ø© -->
            </div>
        </div>
    </div>

    <script>
        // ==================== A. Supabase Configuration ====================
        const SUPABASE_URL = 'https://pzsxhypigslcvduegvpa.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6c3hoeXBpZ3NsY3ZkdWVndnBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0OTMxOTQsImV4cCI6MjA4MTA2OTE5ND0.0LC452nPLSywGh1mKxNQedm3M_yWZ4srck-gK67iZag';
        
        let supabaseClient;
        let currentUser = null;
        let allEvaluations = [];
        let filteredEvaluations = [];
        let allEmployees = [];
        let allUsers = []; 
        let filteredUsers = []; 
        let systemStats = { totalEvaluations: 0, totalEmployees: 0, pendingCount: 0, deletedCount: 0 };
        let allProjects = [];

        // ==================== B. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ====================
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ù…Ø³Ø¦ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…...'); 
            
            try {
                currentUser = JSON.parse(localStorage.getItem('caritas_user')); 
                if (!currentUser) { 
                    window.location.href = 'index.html'; 
                    return;
                }
                
                if (currentUser.role_id !== 7) { 
                    alert('â›” Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©'); 
                    setTimeout(() => { 
                        window.location.href = 'index.html'; 
                    }, 2000);
                    return;
                }

                document.getElementById('currentAdmin').textContent = currentUser.full_name; 

                supabaseClient = supabase.createClient(SUPABASE_URL.trim(), SUPABASE_KEY.trim());
                console.log('âœ… Supabase client initialized');

                await loadAllData(); 
                updateStats(); 
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­'); 

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©:', error); 
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); 
            }
        });

        // ==================== C. ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ====================

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex'; 
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none'; 
        }

        function showError(message) {
            alert('âŒ Ø®Ø·Ø£: ' + message); 
        }

        function closeModal() {
            document.getElementById('actionModal').style.display = 'none'; 
        }

        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active'); 
            });
            document.getElementById(sectionId).classList.add('active'); 

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active'); 
            });
            document.querySelector(`.nav-link[href="#${sectionId}"]`).classList.add('active'); 
        }

        function getRoleName(roleId) {
            switch (parseInt(roleId)) {
                case 1: return 'Ø£Ø®ØµØ§Ø¦ÙŠ Ù…ÙŠØ¯Ø§Ù†ÙŠ';
                case 2: return 'Ù…Ø³Ø¤ÙˆÙ„ ÙØ±ÙŠÙ‚';
                case 3: return 'Ù…Ø¯ÙŠØ± ÙØ±Ø¹';
                case 4: return 'Ù…Ø¯ÙŠØ± Ù†Ø´Ø§Ø·';
                case 5: return 'Ø¥Ø¯Ø§Ø±ÙŠ';
                case 6: return 'Ù…Ø±ÙƒØ² Ø±Ø¦ÙŠØ³ÙŠ';
                case 7: return 'Ù…Ø³Ø¦ÙˆÙ„ Ù†Ø¸Ø§Ù…';
                default: return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            }
        } 

        function getBranchName(branch) {
            switch (branch) {
                case 'ÙØ±Ø¹ Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±': return 'Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±';
                case 'ÙØ±Ø¹ Ø£Ø³ÙŠÙˆØ·': return 'Ø£Ø³ÙŠÙˆØ·';
                case 'ÙØ±Ø¹ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©': return 'Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©';
                case 'ÙØ±Ø¹ Ø§Ù„Ø£Ù‚ØµØ±': return 'Ø§Ù„Ø£Ù‚ØµØ±';
                case 'ÙØ±Ø¹ Ø§Ù„Ù…Ù†ÙŠØ§': return 'Ø§Ù„Ù…Ù†ÙŠØ§';
                case 'ÙØ±Ø¹ Ø³ÙˆÙ‡Ø§Ø¬': return 'Ø³ÙˆÙ‡Ø§Ø¬';
                case 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©': return 'Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ';
                default: return branch || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            }
        }

        function getScoreText(score) {
            const scores = {
                10: 'Ù…Ù…ØªØ§Ø²',
                9: 'Ù…Ù…ØªØ§Ø²',
                8: 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹',
                7: 'Ø¬ÙŠØ¯',
                6: 'Ù…Ù‚Ø¨ÙˆÙ„',
                5: 'Ù…Ù‚Ø¨ÙˆÙ„',
                4: 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†',
                3: 'Ø¶Ø¹ÙŠÙ',
                2: 'Ø¶Ø¹ÙŠÙ Ø¬Ø¯Ø§Ù‹',
                1: 'ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„'
            };
            return scores[score] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }

        function logAuditAction(action, description) {
            console.log(`ğŸ“ Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚: ${action} - ${description}`); 
            const timestamp = new Date().toISOString(); 
            
            const auditLog = JSON.parse(localStorage.getItem('caritas_audit_log') || '[]'); 
            auditLog.unshift({ 
                timestamp,
                user_id: currentUser.id,
                user_name: currentUser.full_name,
                action,
                description,
                details: {
                    role_id: currentUser.role_id,
                    role_name: getRoleName(currentUser.role_id)
                }
            });
            
            if (auditLog.length > 100) { 
                auditLog.length = 100;
            }
            localStorage.setItem('caritas_audit_log', JSON.stringify(auditLog)); 
        }
        
        // ==================== D. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ====================

        async function loadAllData() {
            showLoading(); 

            try {
                await loadAssessmentsData(); 
                await loadEmployeesData(); 
                await loadUsersData(); 
                await loadProjectsData();
                updateStats(); 
                hideLoading(); 
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error); 
                hideLoading(); 
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); 
            }
        }

        async function loadProjectsData() {
            try {
                const { data: projects, error } = await supabaseClient
                    .from('projects')
                    .select('*')
                    .eq('is_active', true);
                
                if (!error) {
                    allProjects = projects || [];
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹:', error);
            }
        }

        async function loadAssessmentsData() {
            try {
                const { data: evaluations, error: evalError } = await supabaseClient
                    .from('evaluation_results')
                    .select(`
                        *,
                        evaluated_employee:evaluated_employee_id(full_name, branch, role_id, national_id, hire_date, insurance_status),
                        evaluator:evaluator_id(full_name, username),
                        project:project_id(project_name),
                        evaluation_cycles:cycle_id(cycle_name),
                        evaluation_questions:question_id(question_text, category)
                    `)
                    .order('created_at', { ascending: false });

                if (!evalError) {
                    allEvaluations = evaluations || [];
                    filteredEvaluations = [...allEvaluations];
                    systemStats.totalEvaluations = allEvaluations.length;
                    systemStats.pendingCount = allEvaluations.filter(e => !e.is_approved).length;
                    systemStats.deletedCount = 0; // Ù„Ù… Ù†Ø¹Ø¯ Ù†Ø­ØªÙØ¸ Ø¨Ø­Ø°Ù Ù…Ù†Ø·Ù‚ÙŠ
                    renderEvaluationsTable();
                    updatePrintSelect();
                } else {
                    throw evalError;
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª');
            }
        } 

        async function loadEmployeesData() {
            try {
                const { data: employees, error: empError } = await supabaseClient
                    .from('employees')
                    .select(`
                        id, 
                        full_name, 
                        username, 
                        email, 
                        branch, 
                        role_id, 
                        manager_id,
                        project_manager_id,
                        is_active, 
                        created_at, 
                        national_id,
                        hire_date,
                        insurance_status,
                        notes
                    `)
                    .eq('is_active', true);
                
                if (!empError) {
                    allEmployees = employees || [];
                    systemStats.totalEmployees = allEmployees.length;
                    updateEmployeeSelect();
                } else {
                    throw empError;
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
            }
        }

        async function loadUsersData() {
            try {
                const { data: users, error } = await supabaseClient
                    .from('employees')
                    .select(`
                        id,
                        full_name,
                        username,
                        email,
                        role_id,
                        branch,
                        is_active,
                        created_at,
                        updated_at,
                        national_id,
                        hire_date,
                        insurance_status,
                        notes,
                        manager_id,
                        project_manager_id
                    `)
                    .order('created_at', { ascending: false });
                
                if (!error) {
                    allUsers = users || [];
                    filteredUsers = [...allUsers];
                    renderUsersTable();
                    updateUsersStats();
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†');
            }
        }

        // ==================== E. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ====================

        function updateStats() {
            document.getElementById('totalEvaluations').textContent = systemStats.totalEvaluations; 
            document.getElementById('totalEmployees').textContent = systemStats.totalEmployees; 
            document.getElementById('pendingCount').textContent = systemStats.pendingCount; 
            document.getElementById('deletedCount').textContent = systemStats.deletedCount; 
        }

        function updateEmployeeSelect() {
            const select = document.getElementById('reportEmployee'); 
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù</option>'; 
            allEmployees.forEach(employee => { 
                const option = document.createElement('option'); 
                option.value = employee.id; 
                option.textContent = `${employee.full_name} (${getBranchName(employee.branch)})`; 
                select.appendChild(option); 
            });
        }

        function updatePrintSelect() {
            const select = document.getElementById('printEvaluation'); 
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± ØªÙ‚ÙŠÙŠÙ…</option>'; 
            allEvaluations.forEach((eval, index) => { 
                const employee = allEmployees.find(e => e.id === eval.evaluated_employee_id); 
                if (employee) { 
                    const option = document.createElement('option'); 
                    option.value = eval.id; 
                    option.textContent = `${employee.full_name} - ${new Date(eval.created_at).toLocaleDateString('ar-SA')} - ${eval.evaluation_cycles?.cycle_name || 'Ø¯ÙˆØ±Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©'}`; 
                    select.appendChild(option); 
                }
            });
        }

        function renderEvaluationsTable() {
            const tbody = document.getElementById('evaluationsBody'); 
            if (filteredEvaluations.length === 0) { 
                tbody.innerHTML = ` 
                    <tr> <td colspan="8" style="text-align: center; padding: 40px; color: #6c757d;"> Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø« </td> </tr> 
                `; 
                return;
            }

            tbody.innerHTML = ''; 
            filteredEvaluations.forEach(evaluation => { 
                const employee = evaluation.evaluated_employee; 
                const evaluatorName = evaluation.evaluator?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'; 
                const employeeName = employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'; 
                const branch = employee?.branch || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'; 
                const roleId = employee?.role_id || 1; 
                const cycleName = evaluation.evaluation_cycles?.cycle_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const projectName = evaluation.project?.project_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                
                const averageScore = evaluation.score ? Math.round((evaluation.score / 10) * 100) : 0; 
                
                const statusText = evaluation.is_approved ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'; 
                const statusClass = evaluation.is_approved ? 'status-completed' : 'status-pending'; 

                const row = document.createElement('tr'); 
                row.innerHTML = ` 
                    <td>${new Date(evaluation.created_at).toLocaleDateString('ar-SA')}</td> 
                    <td><strong>${employeeName}</strong></td> 
                    <td>${evaluatorName}</td> 
                    <td>${getBranchName(branch)}</td> 
                    <td>${getRoleName(roleId)}</td> 
                    <td>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </td> 
                    <td><strong style="color: #1abc9c">${averageScore}%</strong></td> 
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-view" onclick="viewEvaluation('${evaluation.id}')">
                                ğŸ‘ï¸ Ø¹Ø±Ø¶
                            </button>
                            <button class="action-btn btn-print" onclick="printEvaluation('${evaluation.id}')">
                                ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                            </button>
                            <button class="action-btn btn-edit" onclick="editEvaluation('${evaluation.id}')">
                                âœï¸ ØªØ¹Ø¯ÙŠÙ„
                            </button>
                            <button class="action-btn" onclick="resubmitEvaluation('${evaluation.id}')" style="background: #3498db; color: white;">
                                ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©
                            </button>
                            <button class="action-btn btn-delete" onclick="deletePermanently('${evaluation.id}')">
                                ğŸ—‘ï¸ Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
                            </button>
                        </div>
                    </td> 
                `; 
                
                tbody.appendChild(row); 
            });
        }

        function filterEvaluations() {
            const branchFilter = document.getElementById('filterBranch').value; 
            const roleFilter = document.getElementById('filterRole').value; 
            const statusFilter = document.getElementById('filterStatus').value; 

            filteredEvaluations = allEvaluations.filter(evaluation => { 
                const employee = evaluation.evaluated_employee; 
                
                if (!employee) return false; 

                if (branchFilter !== 'all' && employee.branch !== branchFilter) { 
                    return false;
                }

                if (roleFilter !== 'all' && employee.role_id.toString() !== roleFilter) { 
                    return false;
                }

                if (statusFilter === 'completed' && !evaluation.is_approved) { 
                    return false;
                }
                if (statusFilter === 'pending' && evaluation.is_approved) { 
                    return false;
                }
                
                return true;
            });

            renderEvaluationsTable(); 
        }

        function searchEvaluations() {
            const searchTerm = document.getElementById('searchEvaluations').value.toLowerCase().trim(); 
            
            if (!searchTerm) { 
                filteredEvaluations = [...allEvaluations]; 
                renderEvaluationsTable(); 
                return;
            }
            
            filteredEvaluations = allEvaluations.filter(evaluation => { 
                const employee = evaluation.evaluated_employee; 
                const evaluatorName = evaluation.evaluator?.full_name || '';
                const employeeName = employee?.full_name || '';
                const nationalId = employee?.national_id || '';
                
                return (
                    (employeeName.toLowerCase().includes(searchTerm)) ||
                    (evaluatorName.toLowerCase().includes(searchTerm)) ||
                    (employee?.branch?.toLowerCase().includes(searchTerm)) ||
                    (getRoleName(employee?.role_id).toLowerCase().includes(searchTerm)) ||
                    (nationalId.includes(searchTerm))
                );
            });

            renderEvaluationsTable();
        }

        // ==================== F. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ====================

        function renderUsersTable() {
            const tbody = document.getElementById('usersBody');
            
            if (!tbody) return;

            if (filteredUsers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ† Ù„Ù„Ø¨Ø­Ø«
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = '';
            
            filteredUsers.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <strong>${user.full_name}</strong>
                        ${user.national_id ? `<br><small style="color: #6c757d;">${user.national_id}</small>` : ''}
                    </td>
                    <td>
                        <code>${user.username}</code><br>
                        <small style="color: #6c757d;">${user.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯'}</small>
                    </td>
                    <td>${getRoleName(user.role_id)}</td>
                    <td>${getBranchName(user.branch)}</td>
                    <td>
                        ${user.is_active ? 
                            '<span class="status-badge status-completed">Ù†Ø´Ø·</span>' : 
                            '<span class="status-badge status-deleted">Ù…Ø¹Ø·Ù„</span>'
                        }
                    </td>
                    <td>
                        ${new Date(user.created_at).toLocaleDateString('ar-SA')}<br>
                        ${user.hire_date ? `<small style="color: #6c757d;">Ø§Ù„ØªØ¹ÙŠÙŠÙ†: ${user.hire_date}</small>` : ''}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-view" onclick="editUser('${user.id}')">
                                âœï¸ ØªØ¹Ø¯ÙŠÙ„
                            </button>
                            ${user.is_active ? 
                                `<button class="action-btn btn-delete" onclick="deactivateUser('${user.id}', '${user.full_name}')">
                                    â›” ØªØ¹Ø·ÙŠÙ„
                                </button>` :
                                `<button class="action-btn btn-restore" onclick="activateUser('${user.id}', '${user.full_name}')">
                                    âœ… ØªÙØ¹ÙŠÙ„
                                </button>`
                            }
                            <button class="action-btn btn-reset" onclick="resetPassword('${user.id}', '${user.full_name}')">
                                ğŸ” Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function updateUsersStats() {
            const totalUsers = allUsers.length;
            const activeUsers = allUsers.filter(u => u.is_active).length;
            const adminsCount = allUsers.filter(u => u.role_id === 7).length;
            const managersCount = allUsers.filter(u => u.role_id === 3 || u.role_id === 4).length;
            
            if(document.getElementById('totalUsers')) document.getElementById('totalUsers').textContent = totalUsers;
            if(document.getElementById('activeUsersCount')) document.getElementById('activeUsersCount').textContent = activeUsers; 
            if(document.getElementById('adminsCount')) document.getElementById('adminsCount').textContent = adminsCount;
            if(document.getElementById('managersCount')) document.getElementById('managersCount').textContent = managersCount;
        }

        function filterUsers() {
            const branchFilter = document.getElementById('filterUsersBranch').value;
            const roleFilter = document.getElementById('filterUsersRole').value;
            
            filteredUsers = allUsers.filter(user => {
                if (branchFilter !== 'all' && user.branch !== branchFilter) {
                    return false;
                }
                
                if (roleFilter !== 'all' && user.role_id.toString() !== roleFilter) {
                    return false;
                }
                
                return true;
            });
            
            renderUsersTable();
        }

        function searchUsers() {
            const searchTerm = document.getElementById('searchUsers').value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredUsers = [...allUsers];
                renderUsersTable();
                return;
            }
            
            filteredUsers = allUsers.filter(user => {
                return (
                    (user.full_name?.toLowerCase() || '').includes(searchTerm) ||
                    (user.username?.toLowerCase() || '').includes(searchTerm) ||
                    (user.email?.toLowerCase() || '').includes(searchTerm) ||
                    (user.national_id?.includes(searchTerm)) ||
                    (user.branch?.toLowerCase() || '').includes(searchTerm)
                );
            });
            
            renderUsersTable();
        }

        async function editUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;
            
            const modalContent = `
                <div style="padding: 20px; color: var(--admin-color);">
                    <h3 style="margin-bottom: 25px; color: var(--admin-color);">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                    
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                        <h4 style="color: var(--admin-color); margin-bottom: 20px;">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *:</label>
                                <input type="text" id="editFullName" class="filter-select" value="${user.full_name}" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *:</label>
                                <input type="text" id="editUsername" class="filter-select" value="${user.username}" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                                <input type="email" id="editEmail" class="filter-select" value="${user.email || ''}" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</label>
                                <input type="text" id="editNationalId" class="filter-select" value="${user.national_id || ''}" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</label>
                                <input type="date" id="editHireDate" class="filter-select" value="${user.hire_date || ''}" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ†:</label>
                                <select id="editInsuranceStatus" class="filter-select" style="width: 100%;">
                                    <option value="" ${!user.insurance_status ? 'selected' : ''}>ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option>
                                    <option value="Ù…Ø¤Ù…Ù†" ${user.insurance_status === 'Ù…Ø¤Ù…Ù†' ? 'selected' : ''}>Ù…Ø¤Ù…Ù†</option>
                                    <option value="ØºÙŠØ± Ù…Ø¤Ù…Ù†" ${user.insurance_status === 'ØºÙŠØ± Ù…Ø¤Ù…Ù†' ? 'selected' : ''}>ØºÙŠØ± Ù…Ø¤Ù…Ù†</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø¯ÙˆØ± *:</label>
                                <select id="editRoleId" class="filter-select" style="width: 100%;">
                                    <option value="1" ${user.role_id === 1 ? 'selected' : ''}>Ø£Ø®ØµØ§Ø¦ÙŠ Ù…ÙŠØ¯Ø§Ù†ÙŠ</option>
                                    <option value="2" ${user.role_id === 2 ? 'selected' : ''}>Ù…Ø³Ø¤ÙˆÙ„ ÙØ±ÙŠÙ‚</option>
                                    <option value="3" ${user.role_id === 3 ? 'selected' : ''}>Ù…Ø¯ÙŠØ± ÙØ±Ø¹</option>
                                    <option value="4" ${user.role_id === 4 ? 'selected' : ''}>Ù…Ø¯ÙŠØ± Ù†Ø´Ø§Ø·</option>
                                    <option value="5" ${user.role_id === 5 ? 'selected' : ''}>Ø¥Ø¯Ø§Ø±ÙŠ</option>
                                    <option value="6" ${user.role_id === 6 ? 'selected' : ''}>Ù…Ø±ÙƒØ² Ø±Ø¦ÙŠØ³ÙŠ</option>
                                    <option value="7" ${user.role_id === 7 ? 'selected' : ''}>Ù…Ø³Ø¦ÙˆÙ„ Ù†Ø¸Ø§Ù…</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„ÙØ±Ø¹ *:</label>
                                <select id="editBranch" class="filter-select" style="width: 100%;">
                                    <option value="ÙØ±Ø¹ Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±" ${user.branch === 'ÙØ±Ø¹ Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±' ? 'selected' : ''}>Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±</option>
                                    <option value="ÙØ±Ø¹ Ø£Ø³ÙŠÙˆØ·" ${user.branch === 'ÙØ±Ø¹ Ø£Ø³ÙŠÙˆØ·' ? 'selected' : ''}>Ø£Ø³ÙŠÙˆØ·</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©" ${user.branch === 'ÙØ±Ø¹ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©' ? 'selected' : ''}>Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ø£Ù‚ØµØ±" ${user.branch === 'ÙØ±Ø¹ Ø§Ù„Ø£Ù‚ØµØ±' ? 'selected' : ''}>Ø§Ù„Ø£Ù‚ØµØ±</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ù…Ù†ÙŠØ§" ${user.branch === 'ÙØ±Ø¹ Ø§Ù„Ù…Ù†ÙŠØ§' ? 'selected' : ''}>Ø§Ù„Ù…Ù†ÙŠØ§</option>
                                    <option value="ÙØ±Ø¹ Ø³ÙˆÙ‡Ø§Ø¬" ${user.branch === 'ÙØ±Ø¹ Ø³ÙˆÙ‡Ø§Ø¬' ? 'selected' : ''}>Ø³ÙˆÙ‡Ø§Ø¬</option>
                                    <option value="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©" ${user.branch === 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©' ? 'selected' : ''}>Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                                <select id="editIsActive" class="filter-select" style="width: 100%;">
                                    <option value="true" ${user.is_active ? 'selected' : ''}>Ù†Ø´Ø·</option>
                                    <option value="false" ${!user.is_active ? 'selected' : ''}>Ù…Ø¹Ø·Ù„</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                            <textarea id="editNotes" class="filter-select" style="width: 100%; height: 80px; resize: vertical;">${user.notes || ''}</textarea>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                        <button onclick="saveUserChanges('${user.id}')" style="padding: 12px 25px; background: var(--admin-accent); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                        </button>
                        <button onclick="closeModal()" style="padding: 12px 25px; background: #6c757d; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('actionModal').style.display = 'flex';
        }

        async function saveUserChanges(userId) {
            const fullName = document.getElementById('editFullName').value.trim();
            const username = document.getElementById('editUsername').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const nationalId = document.getElementById('editNationalId').value.trim();
            const hireDate = document.getElementById('editHireDate').value;
            const insuranceStatus = document.getElementById('editInsuranceStatus').value;
            const roleId = parseInt(document.getElementById('editRoleId').value);
            const branch = document.getElementById('editBranch').value;
            const isActive = document.getElementById('editIsActive').value === 'true';
            const notes = document.getElementById('editNotes').value.trim();
            
            if (!fullName || !username) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                return;
            }
            
            showLoading();
            
            try {
                const updateData = {
                    full_name: fullName,
                    username: username,
                    email: email || null,
                    role_id: roleId,
                    branch: branch,
                    is_active: isActive,
                    updated_at: new Date().toISOString(),
                    national_id: nationalId || null,
                    hire_date: hireDate || null,
                    insurance_status: insuranceStatus || null,
                    notes: notes || null
                };
                
                const { error } = await supabaseClient
                    .from('employees')
                    .update(updateData)
                    .eq('id', userId);
                
                if (error) throw error;
                
                const userIndex = allUsers.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    allUsers[userIndex] = {
                        ...allUsers[userIndex],
                        ...updateData
                    };
                }
                
                renderUsersTable();
                updateUsersStats();
                
                hideLoading();
                closeModal();
                
                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                
                logAuditAction('update_user', `ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… ${fullName}`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function deactivateUser(userId, userName) {
            if (!confirm(`âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:\n${userName}ØŸ`)) return;
            
            showLoading();
            
            try {
                const { error } = await supabaseClient
                    .from('employees')
                    .update({ 
                        is_active: false,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', userId);
                
                if (error) throw error;
                
                const userIndex = allUsers.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    allUsers[userIndex].is_active = false;
                }
                
                renderUsersTable();
                updateUsersStats();
                
                hideLoading();
                alert('âœ… ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                
                logAuditAction('deactivate_user', `ØªØ¹Ø·ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… ${userName}`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function activateUser(userId, userName) {
            if (!confirm(`âœ… Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:\n${userName}ØŸ`)) return;
            
            showLoading();
            
            try {
                const { error } = await supabaseClient
                    .from('employees')
                    .update({ 
                        is_active: true,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', userId);
                
                if (error) throw error;
                
                const userIndex = allUsers.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    allUsers[userIndex].is_active = true;
                }
                
                renderUsersTable();
                updateUsersStats();
                
                hideLoading();
                alert('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                
                logAuditAction('activate_user', `ØªÙØ¹ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… ${userName}`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function resetPassword(userId, userName) {
            const newPassword = prompt(`ğŸ” Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù€:\n${userName}\n\nØ£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:`);
            
            if (!newPassword || newPassword.length < 4) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            if (!confirm(`âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù€:\n${userName}\n\nÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${newPassword}`)) {
                return;
            }
            
            showLoading();
            
            try {
                const { error } = await supabaseClient
                    .from('employees')
                    .update({ 
                        password_hash: newPassword,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', userId);
                
                if (error) throw error;
                
                hideLoading();
                alert(`âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­\n\nØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userName}\nÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${newPassword}`);
                
                logAuditAction('reset_password', `Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ù€ ${userName}`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
            }
        }

        async function showAddUserModal() {
            const modalContent = `
                <div style="padding: 20px; color: var(--admin-color);">
                    <h3 style="margin-bottom: 25px; color: var(--admin-color);">ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
                    
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px;">
                        <h4 style="color: var(--admin-color); margin-bottom: 20px;">ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *:</label>
                                <input type="text" id="newFullName" class="filter-select" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *:</label>
                                <input type="text" id="newUsername" class="filter-select" placeholder="username" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                                <input type="email" id="newEmail" class="filter-select" placeholder="email@example.com" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</label>
                                <input type="text" id="newNationalId" class="filter-select" placeholder="14 Ø±Ù‚Ù…" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *:</label>
                                <input type="text" id="newPassword" class="filter-select" value="pass123" style="width: 100%;">
                                <small style="color: #6c757d; font-size: 12px;">ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØºÙŠÙŠØ±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹</small>
                            </div>
                            <div>
                                <label class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *:</label>
                                <input type="text" id="confirmPassword" class="filter-select" value="pass123" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</label>
                                <input type="date" id="newHireDate" class="filter-select" style="width: 100%;">
                            </div>
                            <div>
                                <label class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ†:</label>
                                <select id="newInsuranceStatus" class="filter-select" style="width: 100%;">
                                    <option value="">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option>
                                    <option value="Ù…Ø¤Ù…Ù†">Ù…Ø¤Ù…Ù†</option>
                                    <option value="ØºÙŠØ± Ù…Ø¤Ù…Ù†">ØºÙŠØ± Ù…Ø¤Ù…Ù†</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø¯ÙˆØ± *:</label>
                                <select id="newRoleId" class="filter-select" style="width: 100%;">
                                    <option value="1">Ø£Ø®ØµØ§Ø¦ÙŠ Ù…ÙŠØ¯Ø§Ù†ÙŠ</option>
                                    <option value="2">Ù…Ø³Ø¤ÙˆÙ„ ÙØ±ÙŠÙ‚</option>
                                    <option value="3">Ù…Ø¯ÙŠØ± ÙØ±Ø¹</option>
                                    <option value="4">Ù…Ø¯ÙŠØ± Ù†Ø´Ø§Ø·</option>
                                    <option value="5">Ø¥Ø¯Ø§Ø±ÙŠ</option>
                                    <option value="6">Ù…Ø±ÙƒØ² Ø±Ø¦ÙŠØ³ÙŠ</option>
                                    <option value="7">Ù…Ø³Ø¦ÙˆÙ„ Ù†Ø¸Ø§Ù…</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„ÙØ±Ø¹ *:</label>
                                <select id="newBranch" class="filter-select" style="width: 100%;">
                                    <option value="ÙØ±Ø¹ Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±">Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±</option>
                                    <option value="ÙØ±Ø¹ Ø£Ø³ÙŠÙˆØ·">Ø£Ø³ÙŠÙˆØ·</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ø£Ù‚ØµØ±">Ø§Ù„Ø£Ù‚ØµØ±</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ù…Ù†ÙŠØ§">Ø§Ù„Ù…Ù†ÙŠØ§</option>
                                    <option value="ÙØ±Ø¹ Ø³ÙˆÙ‡Ø§Ø¬">Ø³ÙˆÙ‡Ø§Ø¬</option>
                                    <option value="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©">Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                            <textarea id="newNotes" class="filter-select" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..." style="width: 100%; height: 60px; resize: vertical;"></textarea>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 20px; background: #e8f4f8; border-radius: 10px;">
                        <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©:</strong>
                        <ul style="margin-top: 10px; padding-right: 20px; color: #6c757d;">
                            <li>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ±ÙŠØ¯Ø§Ù‹ ÙˆØºÙŠØ± Ù…ÙƒØ±Ø±</li>
                            <li>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù‡ÙŠ pass123 ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡Ø§</li>
                            <li>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø³ÙŠÙƒÙˆÙ† Ù†Ø´Ø·Ø§Ù‹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
                            <li>ÙŠØ¬Ø¨ Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</li>
                        </ul>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                        <button onclick="addNewUser()" style="padding: 12px 25px; background: var(--admin-accent); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                            â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                        </button>
                        <button onclick="closeModal()" style="padding: 12px 25px; background: #6c757d; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('modalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯';
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('actionModal').style.display = 'flex';
        }

        async function addNewUser() {
            const fullName = document.getElementById('newFullName').value.trim();
            const username = document.getElementById('newUsername').value.trim();
            const email = document.getElementById('newEmail').value.trim();
            const nationalId = document.getElementById('newNationalId').value.trim();
            const hireDate = document.getElementById('newHireDate').value;
            const insuranceStatus = document.getElementById('newInsuranceStatus').value;
            const password = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const roleId = parseInt(document.getElementById('newRoleId').value);
            const branch = document.getElementById('newBranch').value;
            const notes = document.getElementById('newNotes').value.trim();
            
            if (!fullName || !username || !password) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØªØ£ÙƒÙŠØ¯Ù‡Ø§ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†');
                return;
            }
            
            if (password.length < 4) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            showLoading();
            
            try {
                const { data: existingUser } = await supabaseClient
                    .from('employees')
                    .select('username, email')
                    .or(`username.eq.${username},email.eq.${email}`)
                    .single();
                
                if (existingUser) {
                    throw new Error('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
                }
                
                const { error } = await supabaseClient
                    .from('employees')
                    .insert({
                        full_name: fullName,
                        username: username,
                        email: email || null,
                        password_hash: password,
                        role_id: roleId,
                        branch: branch,
                        is_active: true,
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString(),
                        national_id: nationalId || null,
                        hire_date: hireDate || null,
                        insurance_status: insuranceStatus || null,
                        notes: notes || null
                    });
                
                if (error) throw error;
                
                await loadUsersData();
                
                hideLoading();
                closeModal();
                
                alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­\n\nØ§Ù„Ø§Ø³Ù…: ${fullName}\nØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${username}\nÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${password}\nØ§Ù„Ø¯ÙˆØ±: ${getRoleName(roleId)}\nØ§Ù„ÙØ±Ø¹: ${getBranchName(branch)}`);
                
                logAuditAction('add_user', `Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ ${fullName}`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                hideLoading();
                
                if (error.message.includes('Ù…ÙˆØ¬ÙˆØ¯')) {
                    showError('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø®Ø±Ù‰');
                } else {
                    showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                }
            }
        }

        // ==================== G. ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ© ====================

        function exportToExcel() {
            alert('âš ï¸ ÙˆØ¸ÙŠÙØ© ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Excel Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°...');
            console.log('ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØµØ¯ÙŠØ±: ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØµØ¯ÙŠØ± Ù‡Ù†Ø§.');
        }

        function refreshSystem() {
            loadAllData();
            alert('ğŸ”„ ØªÙ… Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù….');
        }

        function logout() {
            localStorage.removeItem('caritas_user');
            window.location.href = 'index.html';
        }

        function backupSystem() {
            alert('ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...');
            logAuditAction('create_backup', 'Ø·Ù„Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
        }

        function showAuditLog() {
            const auditLog = JSON.parse(localStorage.getItem('caritas_audit_log') || '[]');
            
            let logHtml = `<div style="max-height: 70vh; overflow-y: auto;">
                <table class="evaluations-table" style="min-width: 600px;">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                            <th>Ø§Ù„ÙˆØµÙ</th>
                        </tr>
                    </thead>
                    <tbody>`;

            if (auditLog.length === 0) {
                logHtml += `<tr><td colspan="4" style="text-align: center; padding: 20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ ØªØ¯Ù‚ÙŠÙ‚ Ø­Ø§Ù„ÙŠØ§Ù‹.</td></tr>`;
            } else {
                auditLog.forEach(log => {
                    logHtml += `
                        <tr>
                            <td>${new Date(log.timestamp).toLocaleString('ar-SA')}</td>
                            <td>${log.user_name} (${getRoleName(log.details.role_id)})</td>
                            <td><strong>${log.action}</strong></td>
                            <td>${log.description}</td>
                        </tr>
                    `;
                });
            }
            
            logHtml += `</tbody></table></div>`;

            document.getElementById('modalTitle').textContent = 'ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚';
            document.getElementById('modalContent').innerHTML = logHtml + `
                <div style="text-align: right; margin-top: 20px;">
                    <button onclick="closeModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
            `;
            document.getElementById('actionModal').style.display = 'flex';
            logAuditAction('view_audit_log', 'Ù…Ø´Ø§Ù‡Ø¯Ø© Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚');
        }

        // ==================== H. Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ====================

        async function viewEvaluation(evaluationId) {
            showLoading();
            try {
                const evaluation = allEvaluations.find(e => e.id === evaluationId);
                if (!evaluation) {
                    showError('Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    return;
                }
                
                const employee = evaluation.evaluated_employee;
                const evaluatorName = evaluation.evaluator?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const questionText = evaluation.evaluation_questions?.question_text || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const cycleName = evaluation.evaluation_cycles?.cycle_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const projectName = evaluation.project?.project_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

                const averageScore = evaluation.score ? Math.round((evaluation.score / 10) * 100) : 0;
                const grade = averageScore >= 90 ? 'Ù…Ù…ØªØ§Ø²' : averageScore >= 80 ? 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' : averageScore >= 70 ? 'Ø¬ÙŠØ¯' : averageScore >= 60 ? 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†' : 'Ø¶Ø¹ÙŠÙ';
                const scoreColor = averageScore >= 90 ? '#1abc9c' : averageScore >= 80 ? '#3498db' : averageScore >= 70 ? '#f1c40f' : averageScore >= 60 ? '#e67e22' : '#e74c3c';

                const modalContent = `
                    <div style="padding: 20px; color: var(--admin-color);">
                        <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                            <h4 style="color: var(--admin-color); margin-bottom: 15px;">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div> <strong>Ø§Ù„Ù…ÙˆØ¸Ù:</strong> ${employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} </div>
                                <div> <strong>Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…:</strong> ${evaluatorName} </div>
                                <div> <strong>Ø§Ù„ÙØ±Ø¹:</strong> ${getBranchName(employee?.branch)} </div>
                                <div> <strong>Ø§Ù„Ø¯ÙˆØ±:</strong> ${getRoleName(employee?.role_id)} </div>
                                <div> <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(evaluation.created_at).toLocaleDateString('ar-SA')} </div>
                                <div> <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${evaluation.is_approved ? '<span style="color: #27ae60;">Ù…ÙƒØªÙ…Ù„</span>' : '<span style="color: #e67e22;">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>'} </div>
                                <div> <strong>Ø§Ù„Ø¯ÙˆØ±Ø©:</strong> ${cycleName} </div>
                                <div> <strong>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong> ${projectName} </div>
                            </div>
                        </div>

                        <div style="background: #e8f4f8; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                            <h4 style="color: var(--admin-color); margin-bottom: 15px;">ğŸ’¯ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„</h4>
                            <div style="text-align: center; margin-bottom: 20px;">
                                <p style="font-size: 18px; color: #6c757d; margin-bottom: 10px;">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ©</p>
                                <h3 style="font-size: 48px; color: ${scoreColor}; font-weight: 800;">
                                    ${evaluation.score || 0} / 10
                                </h3>
                                <p style="font-size: 24px; color: ${scoreColor}; font-weight: 700;">
                                    (${averageScore}%) - ${grade}
                                </p>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <strong>Ø³Ø¤Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong>
                                <p style="margin-top: 10px; padding: 10px; background: white; border-radius: 8px;">
                                    ${questionText}
                                </p>
                            </div>
                            <div style="line-height: 1.8;">
                                <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…:</strong>
                                <p style="margin-top: 10px; padding: 10px; background: white; border-radius: 8px;">
                                    ${evaluation.comment || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª.'}
                                </p>
                            </div>
                        </div>
                        
                        ${employee?.national_id ? `
                        <div style="background: #f0f8ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h5 style="color: var(--admin-color); margin-bottom: 10px;">ğŸ“„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ù…ÙˆØ¸Ù</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</strong> ${employee.national_id}</div>
                                <div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</strong> ${employee.hire_date || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                <div><strong>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ†:</strong> ${employee.insurance_status || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            </div>
                        </div>
                        ` : ''}

                        <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                            <button onclick="printEvaluation('${evaluationId}')" style="padding: 12px 25px; background: #3498db; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                                ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                            </button>
                            <button onclick="editEvaluation('${evaluationId}')" style="padding: 12px 25px; background: #1abc9c; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                                âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                            </button>
                            <button onclick="closeModal()" style="padding: 12px 25px; background: #6c757d; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                        </div>
                    </div>
                `;

                document.getElementById('modalTitle').textContent = 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…';
                document.getElementById('modalContent').innerHTML = modalContent;
                document.getElementById('actionModal').style.display = 'flex';
                hideLoading();

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„');
            }
        }

        // ==================== I. Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø°Ù ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ====================

        // ğŸ”¥ 1. Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function deletePermanently(evaluationId) {
            if (!confirm('âš ï¸ âš ï¸ âš ï¸ Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ ÙÙŠÙ‡!')) {
                return;
            }
            
            const reason = prompt('Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:');
            if (!reason) {
                alert('âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù');
                return;
            }
            
            showLoading();
            
            try {
                const evaluation = allEvaluations.find(e => e.id === evaluationId);
                if (!evaluation) {
                    throw new Error('Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                }
                
                const { error } = await supabaseClient
                    .from('evaluation_results')
                    .delete()
                    .eq('id', evaluationId);
                
                if (error) throw error;
                
                allEvaluations = allEvaluations.filter(e => e.id !== evaluationId);
                filteredEvaluations = filteredEvaluations.filter(e => e.id !== evaluationId);
                
                systemStats.totalEvaluations = allEvaluations.length;
                systemStats.pendingCount = allEvaluations.filter(e => !e.is_approved).length;
                updateStats();
                
                renderEvaluationsTable();
                
                hideLoading();
                alert('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
                
                logAuditAction('delete_permanent', `Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ Ù„ØªÙ‚ÙŠÙŠÙ… ${evaluationId} - Ø§Ù„Ø³Ø¨Ø¨: ${reason}`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ');
            }
        }

        // âœï¸ 2. ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
        async function editEvaluation(evaluationId) {
            const evaluation = allEvaluations.find(e => e.id === evaluationId);
            if (!evaluation) {
                showError('Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            const employee = evaluation.evaluated_employee;
            const currentScore = evaluation.score || 0;
            const currentComment = evaluation.comment || '';
            const currentProjectId = evaluation.project_id || '';
            
            const modalContent = `
                <div style="padding: 20px; color: var(--admin-color);">
                    <h3 style="margin-bottom: 25px; color: var(--admin-color);">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
                    
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                        <h4 style="color: var(--admin-color); margin-bottom: 20px;">ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div>
                                <strong>Ø§Ù„Ù…ÙˆØ¸Ù:</strong> ${employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                            </div>
                            <div>
                                <strong>Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong> ${currentScore}/10
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label class="form-label">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (1-10):</label>
                            <select id="editScoreValue" class="filter-select" style="width: 100%;">
                                <option value="">Ø§Ø®ØªØ± Ø¯Ø±Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø©</option>
                                ${Array.from({length: 10}, (_, i) => {
                                    const score = 10 - i;
                                    return `<option value="${score}" ${score === currentScore ? 'selected' : ''}>
                                        ${score} - ${getScoreText(score)}
                                    </option>`;
                                }).join('')}
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label class="form-label">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</label>
                            <select id="editProjectId" class="filter-select" style="width: 100%;">
                                <option value="">Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹</option>
                                ${allProjects.map(project => `
                                    <option value="${project.id}" ${project.id === currentProjectId ? 'selected' : ''}>
                                        ${project.project_name}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label class="form-label">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
                            <textarea id="editCommentValue" class="filter-select" 
                                      placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹..."
                                      style="width: 100%; height: 120px; resize: vertical;">${currentComment}</textarea>
                        </div>
                        
                        <div>
                            <label class="form-label">Ø³Ø¨Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„:</label>
                            <input type="text" id="editReason" class="filter-select" 
                                   placeholder="Ù…Ø«Ø§Ù„: ØªØµØ­ÙŠØ­ Ø®Ø·Ø£ØŒ ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª..."
                                   style="width: 100%;">
                        </div>
                    </div>
                    
                    <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                        <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ³ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙˆØ±Ø§Ù‹.</p>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button onclick="saveEvaluationEdit('${evaluationId}')" style="padding: 12px 25px; background: var(--admin-accent); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                        </button>
                        <button onclick="closeModal()" style="padding: 12px 25px; background: #6c757d; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…';
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('actionModal').style.display = 'flex';
        }

        // ğŸ’¾ 3. Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
        async function saveEvaluationEdit(evaluationId) {
            const newScore = document.getElementById('editScoreValue').value;
            const newComment = document.getElementById('editCommentValue').value;
            const newProjectId = document.getElementById('editProjectId').value;
            const editReason = document.getElementById('editReason').value.trim();
            
            if (!newScore) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø±Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø©');
                return;
            }
            
            if (!editReason) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');
                return;
            }
            
            showLoading();
            
            try {
                const updateData = {
                    score: parseInt(newScore),
                    comment: newComment,
                    updated_at: new Date().toISOString(),
                    edit_reason: editReason,
                    edited_by: currentUser.id,
                    edited_at: new Date().toISOString()
                };
                
                if (newProjectId) {
                    updateData.project_id = newProjectId;
                }
                
                const { error } = await supabaseClient
                    .from('evaluation_results')
                    .update(updateData)
                    .eq('id', evaluationId);
                
                if (error) throw error;
                
                const evalIndex = allEvaluations.findIndex(e => e.id === evaluationId);
                if (evalIndex !== -1) {
                    allEvaluations[evalIndex] = {
                        ...allEvaluations[evalIndex],
                        ...updateData
                    };
                }
                
                renderEvaluationsTable();
                
                hideLoading();
                closeModal();
                
                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­');
                
                logAuditAction('edit_evaluation', `ØªØ¹Ø¯ÙŠÙ„ ØªÙ‚ÙŠÙŠÙ… ${evaluationId} - Ø§Ù„Ø³Ø¨Ø¨: ${editReason}`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚ÙŠÙŠÙ…');
            }
        }

        // ğŸ”„ 4. Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯ (Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„)
        async function resubmitEvaluation(evaluationId) {
            const evaluation = allEvaluations.find(e => e.id === evaluationId);
            if (!evaluation) {
                showError('Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            const employee = evaluation.evaluated_employee;
            
            const modalContent = `
                <div style="padding: 20px; color: var(--admin-color);">
                    <h3 style="margin-bottom: 25px; color: var(--admin-color);">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
                    
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                        <h4 style="color: var(--admin-color); margin-bottom: 20px;">â• Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯</h4>
                        
                        <div style="margin-bottom: 20px;">
                            <p><strong>Ø§Ù„Ù…ÙˆØ¸Ù:</strong> ${employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                            <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯ Ø¨Ù†ÙØ³ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ù„Ù…Ù‚ÙŠÙ‘Ù…</p>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label class="form-label">Ø§Ù„Ø¯Ø±Ø¬Ø© (1-10):</label>
                            <select id="resubmitScore" class="filter-select" style="width: 100%;">
                                <option value="">Ø§Ø®ØªØ± Ø¯Ø±Ø¬Ø©</option>
                                ${Array.from({length: 10}, (_, i) => {
                                    const score = 10 - i;
                                    return `<option value="${score}">
                                        ${score} - ${getScoreText(score)}
                                    </option>`;
                                }).join('')}
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label class="form-label">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</label>
                            <select id="resubmitProjectId" class="filter-select" style="width: 100%;">
                                <option value="">Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹</option>
                                ${allProjects.map(project => `
                                    <option value="${project.id}" ${project.id === evaluation.project_id ? 'selected' : ''}>
                                        ${project.project_name}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label class="form-label">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚:</label>
                            <textarea id="resubmitComment" class="filter-select" 
                                      placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹..."
                                      style="width: 100%; height: 100px; resize: vertical;">${evaluation.comment || ''}</textarea>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button onclick="createNewEvaluationCopy('${evaluationId}')" style="padding: 12px 25px; background: #27ae60; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                            â• Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙŠØ¯
                        </button>
                        <button onclick="closeModal()" style="padding: 12px 25px; background: #6c757d; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('modalTitle').textContent = 'Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…';
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('actionModal').style.display = 'flex';
        }

        // â• 5. Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
        async function createNewEvaluationCopy(oldEvaluationId) {
            const newScore = document.getElementById('resubmitScore').value;
            const newComment = document.getElementById('resubmitComment').value;
            const newProjectId = document.getElementById('resubmitProjectId').value;
            
            if (!newScore) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø±Ø¬Ø©');
                return;
            }
            
            const oldEvaluation = allEvaluations.find(e => e.id === oldEvaluationId);
            if (!oldEvaluation) {
                showError('Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£ØµÙ„ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            showLoading();
            
            try {
                const insertData = {
                    evaluated_employee_id: oldEvaluation.evaluated_employee_id,
                    evaluator_id: oldEvaluation.evaluator_id,
                    question_id: oldEvaluation.question_id,
                    score: parseInt(newScore),
                    comment: newComment,
                    cycle_id: oldEvaluation.cycle_id,
                    is_approved: oldEvaluation.is_approved,
                    created_at: new Date().toISOString(),
                    edit_reason: 'Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„',
                    edited_by: currentUser.id,
                    edited_at: new Date().toISOString()
                };
                
                if (newProjectId) {
                    insertData.project_id = newProjectId;
                }
                
                const { data, error } = await supabaseClient
                    .from('evaluation_results')
                    .insert(insertData)
                    .select();
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    allEvaluations.unshift(data[0]);
                    filteredEvaluations.unshift(data[0]);
                    
                    systemStats.totalEvaluations = allEvaluations.length;
                    updateStats();
                    
                    renderEvaluationsTable();
                    
                    hideLoading();
                    closeModal();
                    
                    alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­');
                    
                    logAuditAction('resubmit_evaluation', `Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚ÙŠÙŠÙ… ${oldEvaluationId}`);
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…');
            }
        }

        // ğŸ› ï¸ 6. Ø£Ø¯Ø§Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        async function showDeleteTool() {
            const modalContent = `
                <div style="padding: 20px; color: var(--admin-color);">
                    <h3 style="margin-bottom: 25px; color: var(--admin-color);">ğŸ’€ Ø£Ø¯Ø§Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h3>
                    
                    <div style="background: #fff3cd; padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #ffc107;">
                        <h4 style="color: #856404; margin-bottom: 15px;">âš ï¸ ØªØ­Ø°ÙŠØ± Ù…Ù‡Ù…:</h4>
                        <p style="color: #856404; line-height: 1.6;">
                            Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.<br>
                            Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ© Ù…Ù† Ø®Ù„Ø§Ù„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.</p>
                        <p>Ù„Ø­Ø°Ù Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ØªØµÙÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡Ø§.</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                        <h5 style="color: var(--admin-color); margin-bottom: 15px;">Ø­Ø°Ù Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±:</h5>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label class="form-label">Ø§Ù„ÙØ±Ø¹:</label>
                                <select id="deleteBranch" class="filter-select" style="width: 100%;">
                                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹</option>
                                    <option value="ÙØ±Ø¹ Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±">Ø£Ø¨Ùˆ Ø§Ù„Ù…Ø·Ø§Ù…ÙŠØ±</option>
                                    <option value="ÙØ±Ø¹ Ø£Ø³ÙŠÙˆØ·">Ø£Ø³ÙŠÙˆØ·</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ø£Ù‚ØµØ±">Ø§Ù„Ø£Ù‚ØµØ±</option>
                                    <option value="ÙØ±Ø¹ Ø§Ù„Ù…Ù†ÙŠØ§">Ø§Ù„Ù…Ù†ÙŠØ§</option>
                                    <option value="ÙØ±Ø¹ Ø³ÙˆÙ‡Ø§Ø¬">Ø³ÙˆÙ‡Ø§Ø¬</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                                <select id="deleteStatus" class="filter-select" style="width: 100%;">
                                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                                    <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</option>
                                    <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top: 20px; display: flex; gap: 15px;">
                            <button onclick="showEvalsForDeletion()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer;">
                                ğŸ” Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù„Ù„Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                        <button onclick="closeModal()" style="padding: 12px 25px; background: #6c757d; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">
                            Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('modalTitle').textContent = 'Ø£Ø¯Ø§Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ';
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('actionModal').style.display = 'flex';
        }

        async function showEvalsForDeletion() {
            const branchFilter = document.getElementById('deleteBranch').value;
            const statusFilter = document.getElementById('deleteStatus').value;
            
            const filtered = allEvaluations.filter(eval => {
                if (branchFilter !== 'all' && eval.evaluated_employee?.branch !== branchFilter) {
                    return false;
                }
                
                if (statusFilter === 'pending' && eval.is_approved) {
                    return false;
                }
                
                if (statusFilter === 'completed' && !eval.is_approved) {
                    return false;
                }
                
                return true;
            });
            
            if (filtered.length === 0) {
                alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ±');
                return;
            }
            
            let html = `<h4 style="margin-bottom: 15px;">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© (${filtered.length})</h4>`;
            html += '<div style="max-height: 300px; overflow-y: auto;">';
            
            filtered.forEach(eval => {
                const employee = eval.evaluated_employee;
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e9ecef; background: white; border-radius: 8px; margin-bottom: 10px;">
                        <div>
                            <strong>${employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</strong>
                            <div style="font-size: 12px; color: #6c757d;"> 
                                ${new Date(eval.created_at).toLocaleDateString('ar-SA')} | ${getBranchName(employee?.branch)} | ${eval.is_approved ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'}
                            </div>
                        </div>
                        <button onclick="deletePermanently('${eval.id}')" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                            Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            
            document.getElementById('modalContent').innerHTML += html;
        }

        // ==================== J. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ====================

        async function printEvaluation(evaluationId) {
            showLoading();
            try {
                const evaluation = allEvaluations.find(e => e.id === evaluationId);
                if (!evaluation) {
                    showError('Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    return;
                }
                
                const employee = evaluation.evaluated_employee;
                const evaluatorName = evaluation.evaluator?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const questionText = evaluation.evaluation_questions?.question_text || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const cycleName = evaluation.evaluation_cycles?.cycle_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const projectName = evaluation.project?.project_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                
                const averageScore = evaluation.score ? Math.round((evaluation.score / 10) * 100) : 0;
                const grade = averageScore >= 90 ? 'Ù…Ù…ØªØ§Ø²' : averageScore >= 80 ? 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' : averageScore >= 70 ? 'Ø¬ÙŠØ¯' : averageScore >= 60 ? 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†' : 'Ø¶Ø¹ÙŠÙ';
                const scoreColor = averageScore >= 90 ? '#1abc9c' : averageScore >= 80 ? '#3498db' : averageScore >= 70 ? '#f1c40f' : averageScore >= 60 ? '#e67e22' : '#e74c3c';

                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html dir="rtl" lang="ar">
                    <head>
                        <meta charset="UTF-8">
                        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… - ${employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</title>
                        <style>
                            body { font-family: 'Segoe UI', Arial, sans-serif; direction: rtl; padding: 30px; margin: 0; color: #2c3e50; }
                            .header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 3px solid #1abc9c; }
                            .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; background: #f8f9fa; padding: 25px; border-radius: 15px; }
                            .evaluation-details { background: #e8f4f8; padding: 25px; border-radius: 15px; margin: 25px 0; }
                            .score-display { text-align: center; font-size: 36px; font-weight: 800; color: ${scoreColor}; }
                            .score-grade { text-align: center; font-size: 24px; color: ${scoreColor}; font-weight: 700; margin-top: 10px;}
                            .footer { text-align: center; margin-top: 50px; padding-top: 20px; border-top: 2px solid #e9ecef; color: #6c757d; font-size: 12px; }
                            .no-print { display: block; }
                            @media print {
                                .no-print { display: none; }
                                body { background: white; padding: 0; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h2>ğŸ“„ ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡</h2>
                            <p style="color: #6c757d;">ÙƒØ§Ø±ÙŠØªØ§Ø³ Ù…ØµØ± - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø§Ù…Ù„ 2025</p>
                        </div>

                        <div class="info-grid">
                            <div><strong>Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ù‚ÙŠÙ‘ÙÙ…:</strong> ${employee?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                            <div><strong>Ø§Ù„Ù…Ù‚ÙŠÙ‘ÙÙ…:</strong> ${evaluatorName}</div>
                            <div><strong>Ø§Ù„ÙØ±Ø¹:</strong> ${getBranchName(employee?.branch)}</div>
                            <div><strong>Ø§Ù„Ø¯ÙˆØ±:</strong> ${getRoleName(employee?.role_id)}</div>
                            <div><strong>Ø§Ù„Ø¯ÙˆØ±Ø©:</strong> ${cycleName}</div>
                            <div><strong>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong> ${projectName}</div>
                            <div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> ${new Date(evaluation.created_at).toLocaleDateString('ar-SA')}</div>
                            <div><strong>Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> ${evaluation.is_approved ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'}</div>
                        </div>

                        <div class="evaluation-details">
                            <h3 style="margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px; color: #3498db;">ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h3>
                            <p class="score-display">${evaluation.score || 0} / 10</p>
                            <p class="score-grade">(${averageScore}%) - ${grade}</p>
                        </div>
                        
                        <div class="evaluation-details" style="background: #f8f9fa;">
                            <h3 style="margin-bottom: 20px; border-bottom: 2px solid #6c757d; padding-bottom: 10px; color: #6c757d;">ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
                            <p><strong>Ø³Ø¤Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong></p>
                            <p style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 8px;">${questionText}</p>
                            <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…:</strong></p>
                            <p style="padding: 10px; background: white; border-radius: 8px;">${evaluation.comment || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø±ÙÙ‚Ø©.'}</p>
                        </div>

                        ${employee?.national_id || employee?.hire_date || employee?.insurance_status ? `
                        <div class="evaluation-details" style="background: #f0f8ff;">
                            <h3 style="margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px; color: #3498db;">ğŸ“„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                ${employee?.national_id ? `<div><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</strong> ${employee.national_id}</div>` : ''}
                                ${employee?.hire_date ? `<div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</strong> ${employee.hire_date}</div>` : ''}
                                ${employee?.insurance_status ? `<div><strong>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ†:</strong> ${employee.insurance_status}</div>` : ''}
                            </div>
                        </div>
                        ` : ''}

                        <div class="footer">
                            <p>Â© ${new Date().getFullYear()} ÙƒØ§Ø±ÙŠØªØ§Ø³ Ù…ØµØ± - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø§Ù…Ù„ 2025</p>
                            <p>ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ø³Ø¦ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… - ${currentUser.full_name}</p>
                            <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleString('ar-SA')}</p>
                        </div>

                        <div class="no-print" style="text-align: center; margin-top: 40px;">
                            <button onclick="window.print()" style="padding: 12px 30px; background: #2c3e50; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 10px;"> ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± </button>
                            <button onclick="window.close()" style="padding: 12px 30px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 10px;"> Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© </button>
                        </div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                hideLoading();

                logAuditAction('print_evaluation', `Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚ÙŠÙŠÙ… ${evaluationId}`);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…');
            }
        }

        // ==================== K. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ====================

        function generateIndividualReport() {
            const employeeId = document.getElementById('reportEmployee').value;
            if (!employeeId) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¸Ù Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            showLoading();

            try {
                const employee = allEmployees.find(e => e.id === employeeId);
                if (!employee) {
                    showError('Ø§Ù„Ù…ÙˆØ¸Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    return;
                }

                const employeeEvaluations = allEvaluations.filter(e => e.evaluated_employee_id === employeeId);

                if (employeeEvaluations.length === 0) {
                    alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù');
                    hideLoading();
                    return;
                }

                const totalScore = employeeEvaluations.reduce((sum, eval) => sum + eval.score, 0);
                const averageScore = Math.round((totalScore / (employeeEvaluations.length * 10)) * 100);
                const grade = averageScore >= 90 ? 'Ù…Ù…ØªØ§Ø²' : averageScore >= 80 ? 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' : averageScore >= 70 ? 'Ø¬ÙŠØ¯' : averageScore >= 60 ? 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†' : 'Ø¶Ø¹ÙŠÙ';
                const scoreColor = averageScore >= 90 ? '#1abc9c' : averageScore >= 80 ? '#3498db' : averageScore >= 70 ? '#f1c40f' : averageScore >= 60 ? '#e67e22' : '#e74c3c';

                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html dir="rtl" lang="ar">
                    <head>
                        <meta charset="UTF-8">
                        <title>ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸Ù - ${employee.full_name}</title>
                        <style>
                            body { font-family: 'Segoe UI', Arial, sans-serif; direction: rtl; padding: 30px; margin: 0; color: #2c3e50; }
                            .header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 3px solid #1abc9c; }
                            .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; background: #f8f9fa; padding: 25px; border-radius: 15px; }
                            .summary-box { text-align: center; margin: 30px 0; padding: 30px; border-radius: 15px; background: #e8f4f8; }
                            .summary-score { font-size: 56px; font-weight: 800; color: ${scoreColor}; }
                            .summary-grade { font-size: 28px; color: ${scoreColor}; font-weight: 700; margin-top: 10px; }
                            .evaluation-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            .evaluation-table th, .evaluation-table td { border: 1px solid #ddd; padding: 12px; text-align: right; }
                            .evaluation-table th { background-color: #2c3e50; color: white; }
                            .grade-badge { padding: 5px 10px; border-radius: 5px; font-weight: 600; font-size: 13px; }
                            .footer { text-align: center; margin-top: 50px; padding-top: 20px; border-top: 2px solid #e9ecef; color: #6c757d; font-size: 14px; }
                            .no-print { display: block; }
                            @media print { .no-print { display: none; } }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h2>ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ±Ø¯ÙŠ Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸Ù</h2>
                            <p style="color: #6c757d;">${employee.full_name}</p>
                        </div>

                        <div class="info-grid">
                            <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${employee.full_name}</div>
                            <div><strong>Ø§Ù„ÙØ±Ø¹:</strong> ${getBranchName(employee.branch)}</div>
                            <div><strong>Ø§Ù„Ø¯ÙˆØ±:</strong> ${getRoleName(employee.role_id)}</div>
                            <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:</strong> ${employeeEvaluations.length}</div>
                            ${employee.national_id ? `<div><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</strong> ${employee.national_id}</div>` : ''}
                            ${employee.hire_date ? `<div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</strong> ${employee.hire_date}</div>` : ''}
                            ${employee.insurance_status ? `<div><strong>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ†:</strong> ${employee.insurance_status}</div>` : ''}
                        </div>

                        <div class="summary-box">
                            <p style="font-size: 20px; color: #6c757d; margin-bottom: 10px;">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…</p>
                            <p class="summary-score">${averageScore}%</p>
                            <p class="summary-grade">${grade}</p>
                        </div>

                        <h3>ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:</h3>
                        <table class="evaluation-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…</th>
                                    <th>Ø§Ù„Ø¯ÙˆØ±Ø©</th>
                                    <th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                                    <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                                    <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                                    <th>Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${employeeEvaluations.map(eval => {
                                    const evaluatorName = eval.evaluator?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                                    const cycleName = eval.evaluation_cycles?.cycle_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                                    const projectName = eval.project?.project_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                                    const scorePercent = eval.score * 10;
                                    const color = scorePercent >= 90 ? '#1abc9c' : scorePercent >= 80 ? '#3498db' : scorePercent >= 70 ? '#f1c40f' : scorePercent >= 60 ? '#e67e22' : '#e74c3c';
                                    const gradeText = scorePercent >= 90 ? 'Ù…Ù…ØªØ§Ø²' : scorePercent >= 80 ? 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹' : scorePercent >= 70 ? 'Ø¬ÙŠØ¯' : scorePercent >= 60 ? 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†' : 'Ø¶Ø¹ÙŠÙ';
                                    return `
                                        <tr>
                                            <td>${new Date(eval.created_at).toLocaleDateString('ar-SA')}</td>
                                            <td>${evaluatorName}</td>
                                            <td>${cycleName}</td>
                                            <td>${projectName}</td>
                                            <td><strong>${eval.score}/10</strong></td>
                                            <td><strong style="color: ${color}">${scorePercent}%</strong></td>
                                            <td> 
                                                <span class="grade-badge" style="background: ${color}20; color: ${color};"> 
                                                    ${gradeText} 
                                                </span> 
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                        
                        <div class="footer">
                            <p>Â© ${new Date().getFullYear()} ÙƒØ§Ø±ÙŠØªØ§Ø³ Ù…ØµØ± - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø§Ù…Ù„ 2025</p>
                            <p>ØªÙ‚Ø±ÙŠØ± Ø®Ø§Øµ Ø¨Ù…Ø³Ø¦ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… - ${currentUser.full_name}</p>
                            <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleString('ar-SA')}</p>
                        </div>
                        <div class="no-print" style="text-align: center; margin-top: 40px;">
                            <button onclick="window.print()" style="padding: 12px 30px; background: #2c3e50; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 10px;"> ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± </button>
                            <button onclick="window.close()" style="padding: 12px 30px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 10px;"> Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© </button>
                        </div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                hideLoading();
                logAuditAction('generate_individual_report', `ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± ÙØ±Ø¯ÙŠ Ù„Ù€ ${employee.full_name}`);

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:', error);
                hideLoading();
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
            }
        }

        function generateComparisonReport() {
            alert('âš ï¸ ÙˆØ¸ÙŠÙØ© ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...');
        }

        function generateStatisticsReport() {
            alert('âš ï¸ ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...');
        }

        function printSelectedEvaluation() {
            const evaluationId = document.getElementById('printEvaluation').value;
            if (!evaluationId) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªÙ‚ÙŠÙŠÙ… Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            printEvaluation(evaluationId);
        }

        function exportStatistics() {
            alert('âš ï¸ ÙˆØ¸ÙŠÙØ© ØªØµØ¯ÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ù„Ù‰ Excel Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...');
        }

        function createBackup() {
            alert('ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...');
            logAuditAction('create_backup', 'Ø·Ù„Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
        }

        function listBackups() {
            alert('ğŸ“‹ Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...');
        }

        function loadDeletedEvaluations() {
            alert('ğŸ”„ Ù„Ù… ØªØ¹Ø¯ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù…ØªØ§Ø­Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©');
        }
    </script>
</body>
</html>